"use strict";const digit="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",decode83=(e,a,t)=>{let o=0;for(;a<t;)o*=83,o+=digit.indexOf(e[a++]);return o},pow=Math.pow,PI=Math.PI,PI2=2*PI,d=3294.6,e=269.025,sRGBToLinear=a=>a>10.31475?pow(a/e+.052132,2.4):a/d,linearTosRGB=a=>~~(a>1227e-8?e*pow(a,.416666)-13.025:a*d+1),signSqr=e=>(e<0?-1:1)*e*e,fastCos=e=>{for(e+=PI/2;e>PI;)e-=PI2;const a=1.27323954*e-.405284735*signSqr(e);return.225*(signSqr(a)-a)+a};function decode(e,a,t,o){const n=decode83(e,0,1),r=n%9+1,s=1+~~(n/9),i=r*s,d=(decode83(e,1,2)+1)/13446*(1|o),c=new Float64Array(3*i);let g=decode83(e,2,6);c[0]=sRGBToLinear(g>>16),c[1]=sRGBToLinear(g>>8&255),c[2]=sRGBToLinear(255&g);let h=0,f=0,w=0,l=0,I=0,B=0,P=0,R=0,S=0,u=0,v=0,C=0,G=0;for(h=1;h<i;h++)g=decode83(e,4+2*h,6+2*h),c[3*h]=signSqr(~~(g/361)-9)*d,c[3*h+1]=signSqr(~~(g/19)%19-9)*d,c[3*h+2]=signSqr(g%19-9)*d;const T=4*a,p=new Uint8ClampedArray(T*t);for(l=0;l<t;l++)for(C=PI*l/t,w=0;w<a;w++){for(I=0,B=0,P=0,G=PI*w/a,f=0;f<s;f++)for(S=fastCos(C*f),h=0;h<r;h++)R=fastCos(G*h)*S,u=3*(h+f*r),I+=c[u]*R,B+=c[u+1]*R,P+=c[u+2]*R;v=4*w+l*T,p[v]=linearTosRGB(I),p[v+1]=linearTosRGB(B),p[v+2]=linearTosRGB(P),p[v+3]=255}return p}const weakCanvasStore={};self.onmessage=async({data:e})=>{var a;const{hash:t,width:o,height:n,punch:r,id:s}=e;e.canvas&&(weakCanvasStore[s]=new WeakRef(e.canvas));const i=null===(a=weakCanvasStore[s])||void 0===a?void 0:a.deref();if(!i)return;i.width=o||i.width,i.height=n||i.height;const d=i.getContext("2d"),c=decode(t,o,n,r),g=d.createImageData(o,n);g.data.set(c);const h=await createImageBitmap(g,0,0,o,n);d.drawImage(h,0,0,i.width,i.height)};