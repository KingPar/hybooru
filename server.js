(()=>{var e={1390:function(e,t,n){"use strict";e=n.nmd(e);var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EM_SIZE=void 0;const s=i(n(6689)),l=n(3308),u=n(1187),c=n(4498),d=n(3112),f=n(4513),p=n(5520),h=n(8144),E=n(785),m=n(8331),g=o(n(455)),_=o(n(7452)),O=o(n(3850)),I=o(n(1678)),v=o(n(8327)),b=o(n(6651)),A=o(n(1255));n(7515),t.EM_SIZE=20,t.default=(0,c.hot)(e)((function({initialData:e}){const n=(0,d.usePageDataInit)(e);return(0,s.useEffect)((()=>{const n=()=>{const e=Math.min(window.innerWidth,window.innerHeight),n=Math.min(1,e/612)*t.EM_SIZE;document.documentElement.style.fontSize=n+"px"};return e._error&&u.toast.error(e._error.message),e._ssrError&&u.toast.error("There was an error during Server Side Rendering."),n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)}),[e]),s.default.createElement(f.SSRProvider,null,s.default.createElement(h.ThemeProvider,{init:e._theme},s.default.createElement(p.ConfigContext.Provider,{value:e._config},s.default.createElement(m.QueryProvider,null,s.default.createElement(d.PageDataContext.Provider,{value:n},s.default.createElement(E.PostsCacheProvider,null,s.default.createElement(l.Switch,null,s.default.createElement(l.Route,{path:"/test",component:g.default}),s.default.createElement(l.Route,{path:"/tags",component:b.default}),s.default.createElement(l.Route,{path:"/posts/:id",component:I.default}),s.default.createElement(l.Route,{path:"/posts",component:O.default}),s.default.createElement(l.Route,{path:"/random",component:v.default}),s.default.createElement(l.Route,{path:"/",exact:!0,component:_.default}),s.default.createElement(A.default,null)),s.default.createElement(u.ToastContainer,null)))))))}))},4749:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(4661),u=o(n(7856)),c=o(n(4628)),d=o(n(3112)),f=o(n(5520)),p=o(n(5386)),h=o(n(505)),E=o(n(2044)),m=o(n(53));n(7917);const g=e=>e.stopPropagation();t.default=function({className:e,sidebar:t,children:n,extraLink:a,searchAction:r="/posts",random:i=!0,simpleSettings:o,dimmed:_}){const O=(0,f.default)(),{ref:I,rect:v}=(0,c.default)(),[,b]=(0,d.default)(!1),[A,y]=(0,s.useState)(!1),[T,N]=(0,s.useState)(!1),P=(0,s.useCallback)((()=>N(!0)),[]),R=(0,s.useCallback)((()=>N(!1)),[]),M=(null==v?void 0:v.width)&&v.width<1e3,L=(0,s.useCallback)((e=>{e.preventDefault(),P()}),[P]),C=(0,s.useCallback)((e=>{e.preventDefault(),y(!0)}),[]);let S="Layout";M&&(S+=" mobile"),e&&(S+=` ${e}`);let D=_||!1;return M&&T&&(D=!0),(0,s.useEffect)((()=>{if(D)return document.documentElement.classList.add("dimmed"),()=>document.documentElement.classList.remove("dimmed")}),[D]),(0,s.useEffect)((()=>{if(!A)return;const e=()=>y(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[A]),s.default.createElement("div",{className:S,ref:I},s.default.createElement("div",{className:`sidebar${T?" open":""}${t?"":" simple"}`},s.default.createElement("div",{className:"logo"},s.default.createElement(l.Link,{to:"/"},O.appName)),s.default.createElement("div",{className:"sidebarContent"},t)),s.default.createElement("div",{className:"header"},M&&s.default.createElement("a",{href:"#",className:"menuButton",onClick:L},s.default.createElement("img",{src:"/static/menu_icon.svg",alt:"menu"})),s.default.createElement("div",{className:"links"},s.default.createElement(l.Link,{to:"/"},"Main Page"),s.default.createElement(l.Link,{to:"/posts"},"All Posts"),s.default.createElement(l.Link,{to:"/tags"},"Tags"),s.default.createElement(l.Link,{to:"/random"},"Random"),s.default.createElement("a",{href:"https://github.com/funmaker/hybooru",target:"_blank",rel:"noreferrer"},"GitHub"),s.default.createElement(E.default,null),a),s.default.createElement(u.default,{className:"search",action:r},s.default.createElement(p.default,{name:"query",placeholder:"Search: flower sky 1girl"}),s.default.createElement(h.default,null,s.default.createElement("a",{className:"settingsButton",href:"#",onClick:C},s.default.createElement("img",{src:"/static/cog.svg",alt:"settings"}))),s.default.createElement("button",{hidden:!0})," ",i&&s.default.createElement("button",{formAction:"/random"},"Random"),s.default.createElement("button",null,"Search")),b&&s.default.createElement("div",{className:"progress"}),s.default.createElement(m.default,{open:A,simpleSettings:o,onClick:g})),s.default.createElement("div",{className:"contentDimmer"+(D?" active":""),onClick:R}),s.default.createElement("div",{className:"content"},n))}},7715:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(6689)),i=n(3308),o=n(4661),s=n(9261);n(9268),t.default=function({count:e}){const t=(0,i.useLocation)(),n=(0,s.qsParse)(t.search),a="string"==typeof n.page&&parseInt(n.page)||0,l=[],u=(e,t)=>{let i;i=null===e?"#":(0,s.qsStringify)(Object.assign(Object.assign({},n),{page:e})),null===e?l.push(r.default.createElement("span",{key:l.length,className:"disabled"},t)):l.push(r.default.createElement(o.Link,{key:l.length,to:i,className:a===e?"active":void 0},t))};u(a-1<0?null:a-1,"˂");for(let t=0;t<9;t++){let n=a-Math.round(4.5)+2;n+9-1>e&&(n=e-9+1),n<1&&(n=1),0===t?u(t,t+1):8===t&&e>1?u(e-1,e):1===t&&n>1||7===t&&n+9-1<e?u(null,"..."):n+t<e&&u(n+t-1,n+t)}return u(a+1>=e?null:a+1,"˃"),r.default.createElement("div",{className:"Pagination"},l)}},7856:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(3308);t.default=function(e){var{action:t}=e,n=o(e,["action"]);const a=(0,l.useHistory)(),r=(0,s.useCallback)((e=>{e.preventDefault();const n=new FormData(e.currentTarget);n.forEach(((e,t)=>""===e&&n.delete(t)));const r=new URLSearchParams(n).toString(),i=e.nativeEvent.submitter,o=i&&i.getAttribute("formaction");a.push(`${o||t}${r?`?${r}`:""}`)}),[t,a]);return s.default.createElement("form",Object.assign({action:t},n,{onSubmit:r}))}},4855:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689));n(2427),t.default=function({url:e,width:t,height:a}){const r=(0,s.useRef)(null);return(0,s.useEffect)((()=>{const s=r.current;if(!s)return;let l=!1,u=null;return(()=>{o(this,void 0,void 0,(function*(){if(window.RufflePlayer=window.RufflePlayer||{},window.RufflePlayer.config={publicPath:"/static/ruffle",polyfills:!1},yield Promise.resolve().then((()=>i(n(325)))),l)return;const r=window.RufflePlayer.newest();u=r.createPlayer(),s.replaceChildren(u),u.load(e),u.style.width=t+"px",u.style.height=a+"px",u.style.maxWidth="100%",u.style.maxHeight="100%",u.addEventListener("loadedmetadata",(()=>{l||(u.style.width=u.metadata.width+"px",u.style.height=u.metadata.height+"px")}))}))})(),()=>{l=!0,u&&u.remove()}}),[e,a,t]),s.default.createElement("div",{className:"Ruffle",ref:r})}},505:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(6689);t.default=function({children:e}){const[t,n]=(0,a.useState)(!1);return(0,a.useEffect)((()=>n(!0)),[]),t&&e||null}},53:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=i(n(6689)),c=n(2854),d=l(n(8394)),f=l(n(4927)),p=l(n(5520)),h=l(n(8331));n(3838),t.default=function(e){var{open:t=!1,simpleSettings:n=!1}=e,a=s(e,["open","simpleSettings"]);const[,r]=(0,h.default)(),i=(0,p.default)(),[l,E]=(0,d.default)("pagination",!1),[m,g]=(0,d.default)("popup",!1),[_,O]=(0,d.default)("namespaces",!1),[I,v]=(0,d.default)("fullHeight",!1),[b,A]=(0,d.default)("thumbnailFade",!0),[y,T]=(0,d.default)("blurhash",!1),N=(0,u.useCallback)((e=>{e.preventDefault(),E(!l)}),[l,E]),P=(0,u.useCallback)((e=>{e.preventDefault(),g(!m)}),[m,g]),R=(0,u.useCallback)((e=>{e.preventDefault(),O(!_)}),[_,O]),M=(0,u.useCallback)((e=>{e.preventDefault(),v(!I)}),[I,v]),L=(0,u.useCallback)((e=>{e.preventDefault(),A(!b)}),[b,A]),C=(0,u.useCallback)((e=>{e.preventDefault(),T(!y)}),[y,T]),S=(0,u.useCallback)((e=>{r((t=>{let n=t.trimRight().split(" ").filter((e=>!e.startsWith("order:"))).join(" ");return n&&!n.endsWith(" ")&&(n+=" "),n+`order:${e.target.value}`}))}),[r]),D=(0,u.useCallback)((e=>{r((t=>{let n=t.trimRight().split(" ").filter((e=>!e.match(c.anyRatingRegex))).join(" ");return n&&!n.endsWith(" ")&&(n+=" "),e.target.value?n+`rating:${e.target.value}`:n}))}),[r]),w=(0,u.useCallback)((e=>o(this,void 0,void 0,(function*(){e.preventDefault();const t=prompt("Password");null!==t&&(yield(0,f.default)({pathname:"/api/regenDB",method:"POST",data:{password:t}}),window.location.reload())}))),[]);let j=null;n||(j=u.default.createElement(u.default.Fragment,null,u.default.createElement("div",null,u.default.createElement("select",{value:"label",onChange:S},u.default.createElement("option",{value:"label",disabled:!0,hidden:!0},"Sorting"),u.default.createElement("option",{value:"date"},"Date Imported (Newest First)"),u.default.createElement("option",{value:"date_asc"},"Date Imported (Oldest First)"),u.default.createElement("option",{value:"score"},"Score (Descending)"),u.default.createElement("option",{value:"score_asc"},"Score (Ascending)"),u.default.createElement("option",{value:"size"},"File Size (Descending)"),u.default.createElement("option",{value:"size_asc"},"File Size (Ascending)"),u.default.createElement("option",{value:"id"},"Id"))),null!==i.ratingStars&&u.default.createElement("div",null,u.default.createElement("select",{value:"label",onChange:D},u.default.createElement("option",{value:"label",disabled:!0,selected:!0,hidden:!0},"Rating"),new Array(i.ratingStars+1).fill(0).map(((e,t)=>u.default.createElement("option",{key:t,value:t.toString()},t))).reverse(),u.default.createElement("option",{value:"none"},"Not Rated"),u.default.createElement("option",{value:""},"Any Rating"))),u.default.createElement("hr",null)));let x=null;return i.passwordSet&&(x=u.default.createElement(u.default.Fragment,null,u.default.createElement("hr",null),u.default.createElement("div",null,u.default.createElement("a",{href:"#",onClick:w},"Rebuild Database")))),t?u.default.createElement("div",Object.assign({className:"SettingsMenu"},a),j,u.default.createElement("div",null,u.default.createElement("a",{href:"#",onClick:N},"Auto Paging: ",l?"No":"Yes")),u.default.createElement("div",null,u.default.createElement("a",{href:"#",onClick:P},"Popup Gallery: ",m?"Yes":"No")),u.default.createElement("div",null,u.default.createElement("a",{href:"#",onClick:R},"Hide Namespaces: ",_?"No":"Yes")),u.default.createElement("div",null,u.default.createElement("a",{href:"#",onClick:M},"Limit Img Height: ",I?"No":"Yes")),u.default.createElement("div",null,u.default.createElement("a",{href:"#",onClick:L},"Thumbnail Fade: ",b?"Yes":"No")),u.default.createElement("div",null,u.default.createElement("a",{href:"#",onClick:C},"Blurhash: ",y?"Yes":"No")),x):null}},7165:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(6689));n(1376),t.default=function(){return r.default.createElement("div",{className:"Spinner"},r.default.createElement("div",null),r.default.createElement("div",null),r.default.createElement("div",null),r.default.createElement("div",null))}},5386:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=i(n(6689)),c=n(2854),d=l(n(5520)),f=l(n(4927)),p=l(n(8394)),h=n(8331);function E({tag:e,posts:t,onClick:n,showNamespace:a}){const r=(0,d.default)();let i,o=e.replace(/_/g," ");const s=o.match(c.namespaceRegex);s&&(a||(o=s[2]),i=r.namespaceColors[s[1]]);const l=(0,u.useCallback)((t=>{t.preventDefault(),n(e)}),[n,e]),f=(0,u.useCallback)((t=>{"Enter"===t.key&&(t.preventDefault(),n(e))}),[n,e]);return u.default.createElement("a",{href:"#",className:"row",onClick:l,onKeyPress:f},u.default.createElement("span",{className:"name",style:{color:i}},o),u.default.createElement("span",{className:"posts"},t))}n(1345),t.default=function(e){var t,n=s(e,[]);const[a]=(0,p.default)("namespaces",!1),[r,i]=(0,u.useState)(null),l=(0,u.useRef)(null),c=(0,u.useRef)(null),d=null===(t=l.current)||void 0===t?void 0:t.getBoundingClientRect(),m=(0,u.useRef)(null),g=(0,u.useRef)(null),_=(0,u.useRef)(null),[O,I]=(0,h.useRTQuery)(),v=(0,u.useRef)(O);v.current=O;const b=(0,u.useCallback)((()=>{m.current&&(clearTimeout(m.current),m.current=null),_.current&&(_.current(),_.current=null)}),[]),A=(0,u.useCallback)((()=>{b(),m.current=setTimeout((()=>o(this,void 0,void 0,(function*(){m.current=null;let e=v.current.split(" ").slice(-1)[0];e.startsWith("-")&&(e=e.slice(1)),e=`*${e}*`;const t=yield(0,f.default)({pathname:"/api/tags",search:{pageSize:10,query:e},cancelCb:e=>_.current=e});i(t.tags)}))),1e3)}),[b]),y=(0,u.useCallback)((()=>{A(),g.current&&clearTimeout(g.current)}),[A]),T=(0,u.useCallback)((()=>{g.current=setTimeout((()=>{g.current=null,i(null),b()}),100)}),[b]),N=(0,u.useCallback)((e=>{A(),I(e.target.value,!0)}),[A,I]),P=(0,u.useCallback)((e=>{I((t=>{var n;null===(n=l.current)||void 0===n||n.focus();const a=t.split(" ");return a[a.length-1].startsWith("-")&&(e=`-${e}`),a[a.length-1]=e,a.join(" ")+" "}),!0)}),[I]),R=(0,u.useCallback)((e=>{"Enter"===e.key&&e.currentTarget.blur()}),[]),M=(0,u.useCallback)((e=>{var t,n;if("ArrowDown"===e.key||"ArrowUp"===e.key){e.preventDefault();const a=[l.current,...Array.from((null===(t=c.current)||void 0===t?void 0:t.children)||[])],r=a.indexOf(document.activeElement);if(r<0)return;null===(n=a[r+("ArrowDown"===e.key?1:-1)])||void 0===n||n.focus()}}),[]);return u.default.createElement("span",{className:"TagInput",onFocus:y,onBlur:T,onKeyDown:M},u.default.createElement("input",Object.assign({value:O},n,{ref:l,autoComplete:"off",autoCorrect:"off",onChange:N,onKeyPress:R})),r&&d&&u.default.createElement("div",{className:"tags",ref:c,style:{left:d.x-1+"px",top:d.y+d.height-1+"px",width:`${d.width+2}px`}},Object.entries(r).map((([e,t])=>u.default.createElement(E,{key:e,tag:e,posts:t,onClick:P,showNamespace:a})))))}},7719:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(4661),u=o(n(5520)),c=n(2854),d=o(n(8394)),f=o(n(8331));function p({header:e,members:t,tags:n,searchMod:a,sorted:r,showNamespaces:i}){const o=(0,s.useMemo)((()=>r?t.slice().sort():t),[t,r]);return s.default.createElement("div",{className:"namespace"},e&&s.default.createElement("b",null,e),o.map((e=>s.default.createElement(m,{key:e,searchMod:a,tag:e,tags:n,showNamespace:i}))))}function h(e,t){const n=e.split(" "),a=n.filter((e=>e&&e!==t&&e!==`-${t}`));return n.includes(t)?a.join(" "):[...a,t].join(" ")}function E(e,t){const n=e.split(" "),a=n.filter((e=>e&&e!==t&&e!==`-${t}`));return n.includes(`-${t}`)?a.join(" "):[...a,`-${t}`].join(" ")}function m({searchMod:e,tag:t,tags:n,showNamespace:a}){const r=(0,u.default)(),[i,o,d]=(0,f.default)();let p,m=t.replace(/_/g," ");const g=m.match(c.namespaceRegex);g&&(a||(m=g[2]),p=r.namespaceColors[g[1]]);const _=i.split(" "),O=d(h(i,t)),I=d(E(i,t)),v=_.includes(t)?"•":"+",b=_.includes(`-${t}`)?"•":"-",A=(0,s.useCallback)((e=>{e.preventDefault(),o((e=>h(e,t)))}),[o,t]),y=(0,s.useCallback)((e=>{e.preventDefault(),o((e=>E(e,t)))}),[o,t]);return s.default.createElement("div",null,e&&s.default.createElement(s.default.Fragment,null,s.default.createElement(l.Link,{className:"btn",to:O,onClick:A},v),s.default.createElement(l.Link,{className:"btn",to:I,onClick:y},b)),s.default.createElement(l.Link,{to:`/posts?query=${encodeURIComponent(t)}`,style:{color:p}},m)," ",s.default.createElement("span",null,n[t]))}n(8562),t.default=s.default.memo((function({tags:e,grouped:t,searchMod:n}){const[a]=(0,d.default)("namespaces",!1);if(t){const t={},a=[];for(const n of Object.keys(e)){const e=n.match(c.namespaceRegex);if(e){const a=e[1];t[a]||(t[a]=[]),t[a].push(n)}else a.push(n)}const r=Object.entries(t).sort(((e,t)=>e[0].localeCompare(t[0])));return s.default.createElement("div",{className:"Tags"},r.map((([t,a])=>s.default.createElement(p,{key:t,header:t,members:a,tags:e,searchMod:n,sorted:!0}))),s.default.createElement(p,{header:"Tags",members:a,tags:e,searchMod:n,sorted:!0}))}return s.default.createElement("div",{className:"Tags"},s.default.createElement(p,{members:Object.keys(e),tags:e,searchMod:n,showNamespaces:a}))}))},2044:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(6689)),s=n(3308),l=i(n(8144));n(9358),t.default=function(){const[,e]=(0,l.default)(),t=(0,s.useLocation)(),n=(0,o.useCallback)((t=>{t.preventDefault(),e(t.currentTarget.theme.value)}),[e]);return o.default.createElement(o.default.Fragment,null,o.default.createElement("form",{className:"ThemeSwitch light",method:"POST",action:"/setTheme",onClick:n},o.default.createElement("input",{type:"hidden",name:"redirectUrl",value:t.pathname+t.search}),o.default.createElement("input",{type:"hidden",name:"theme",value:l.Theme.DARK}),o.default.createElement("input",{type:"image",src:"/static/bulb_off.svg",alt:"Theme"})),o.default.createElement("form",{className:"ThemeSwitch dark",method:"POST",action:"/setTheme",onClick:n},o.default.createElement("input",{type:"hidden",name:"redirectUrl",value:t.pathname+t.search}),o.default.createElement("input",{type:"hidden",name:"theme",value:l.Theme.LIGHT}),o.default.createElement("input",{type:"image",src:"/static/bulb_on.svg",alt:"Theme"})))}},7925:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(4661),u=n(5258),c=n(6918),d=n(2854),f=n(9261),p=o(n(8394)),h=o(n(4513)),E=o(n(5520)),m=o(n(8331)),g=n(1390);n(1044),t.default=function({id:e,post:t,noFade:n,onClick:a,useId:r,label:i}){const o=(0,h.default)(),_=(0,E.default)(),O=(0,s.useRef)(null),[I]=(0,p.default)("thumbnailFade",!0),[v]=(0,p.default)("blurhash",!1),[b]=(0,s.useState)(I&&!n&&!o),[A,y]=(0,s.useReducer)((()=>!0),!1),[T,N]=(0,s.useReducer)((()=>!0),!1);let[P]=(0,m.default)();P=P&&`?query=${encodeURIComponent(P)}`;const R=(0,s.useCallback)((t=>{a&&a(t,e)}),[a,e]);(0,s.useEffect)((()=>{var e;(null===(e=O.current)||void 0===e?void 0:e.complete)&&0===O.current.naturalWidth&&N()}),[]);let M,L=(0,d.thumbnailUrl)(t);return T&&(L="/static/file.svg"),M=_.thumbnailsMode===c.ThumbnailsMode.FIT&&t.width&&t.height?t.width/t.height:_.thumbnailSize[0]/_.thumbnailSize[1],s.default.createElement(l.Link,{className:"Thumbnail",to:`/posts/${t.id}${P}`,onClick:R},s.default.createElement("div",{className:(0,f.classJoin)("imgWrap",b&&"fade",A&&"loaded",T&&"unknown",_.thumbnailsMode===c.ThumbnailsMode.FILL&&"fill",_.thumbnailsMode===c.ThumbnailsMode.FIT&&"fit"),"data-ext":t.extension.slice(1),style:{width:_.thumbnailSize[0]/g.EM_SIZE+"em",height:_.thumbnailSize[1]/g.EM_SIZE+"em"}},!o&&v&&t.blurhash&&s.default.createElement(u.BlurhashCanvas,{className:"Blurhash",imageRef:O,hash:t.blurhash,loading:"eager",width:32,height:Math.ceil(32/M)}),s.default.createElement("img",{src:L,alt:String(t.id),id:r?t.id.toString():void 0,onLoad:y,onError:N,ref:O})),i&&s.default.createElement("label",null,i))}},4927:function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(7805)),o=r(n(2167)),s=n(1187),l=n(9261),u=o.default.CancelToken;t.default=function(e={}){var t,n,r;return a(this,void 0,void 0,(function*(){if(i.default)return new Promise((()=>{}));let a,{method:c,href:d,host:f,pathname:p,search:h,cancelCb:E,data:m}=e;f=f||location.host,p=p||location.pathname,h&&"string"!=typeof h&&(h=(0,l.qsStringify)(h)),h=h||location.search,d=d||`//${f}${p}${h}`,c=c||"GET";try{a=yield(0,o.default)({method:c,url:d,data:m,cancelToken:E?new u(E):void 0})}catch(e){throw e instanceof o.default.Cancel||s.toast.error((null===(r=null===(n=null===(t=e.response)||void 0===t?void 0:t.data)||void 0===n?void 0:n._error)||void 0===r?void 0:r.message)||e.message),e}return a.data}))}},9261:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseDuration=t.parseSize=t.qsParse=t.qsStringify=t.classJoin=void 0;const r=a(n(7104));t.classJoin=function(...e){return e.filter((e=>e)).join(" ")||void 0},t.qsStringify=function(e,t){return r.default.stringify(e,Object.assign({arrayFormat:"brackets",addQueryPrefix:!0},t))},t.qsParse=function(e,t){return r.default.parse(e,Object.assign({ignoreQueryPrefix:!0},t))},t.parseSize=function(e){return e>1099511627776?Math.round(e/1024/1024/1024/1024*100)/100+" TB":e>1073741824?Math.round(e/1024/1024/1024*100)/100+" GB":e>1048576?Math.round(e/1024/1024*100)/100+" MB":e>1024?Math.round(e/1024*100)/100+" KB":Math.round(100*e)/100+" B"},t.parseDuration=function(e){const t=Math.floor(e/60/60/1e3),n=Math.floor(e/60/1e3%60).toString(),a=Math.floor(e/1e3%60).toString(),r=Math.floor(e%1e3).toString();let i;return i=t>0?`${t}:${n.padStart(2,"0")}:${a.padStart(2,"0")}.${r.padStart(4,"0")}`:`${n}:${a.padStart(2,"0")}.${r.padStart(3,"0")}`,i}},3776:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(6689);t.default=function(e,t){const n=(0,a.useRef)(e),r=(0,a.useRef)(t);r.current=t,(0,a.useEffect)((()=>{n.current!==e&&(r.current(e,n.current),n.current=e)}),[e])}},5520:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigContext=void 0;const o=i(n(6689));t.ConfigContext=o.default.createContext(null),t.default=function(){return(0,o.useContext)(t.ConfigContext)}},8394:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6689),i=a(n(4513));function o(e,t){if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.error(e)}return t}const s=new Set;t.default=function(e,t){const n=(0,i.default)(),[a,l]=(0,r.useState)(n?t:o(localStorage.getItem(e),t)),u=(0,r.useCallback)((t=>{void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t)),s.forEach((n=>n(e,t))),l(t)}),[e]);return(0,r.useEffect)((()=>{const t=(t,n)=>{t===e&&l(n)};return s.add(t),()=>{s.delete(t)}}),[t,e]),(0,r.useEffect)((()=>{const t=o(localStorage.getItem(e));void 0!==t&&t!==a&&l(t)}),[]),[a,u]}},4628:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6689),i=a(n(6827));t.default=function(){const[e,t]=(0,r.useState)(null),[n,a]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(!n)return;const e=new i.default((([e])=>t(e.contentRect)));return e.observe(n),t(n.getBoundingClientRect()),()=>{e.disconnect()}}),[n]),{ref:a,rect:e}}},3112:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usePageDataInit=t.PageDataContext=void 0;const s=i(n(6689)),l=n(3308),u=o(n(4927));t.PageDataContext=s.default.createContext({pageData:null,locationKey:void 0,fetch:()=>{throw new Error("Not Initialized")},fetching:!1}),t.usePageDataInit=function(e){e._error&&(e=null);const t=(0,l.useHistory)(),[{locationKey:n,pageData:a},r]=(0,s.useState)({locationKey:t.location.key,pageData:e||null}),[i,o]=(0,s.useState)(!1),c=(0,s.useRef)(null),d=(0,s.useRef)({});(0,s.useEffect)((()=>(d.current[t.location.pathname]=document.title,t.listen((e=>{var n,a;(null===(n=c.current)||void 0===n?void 0:n.key)&&c.current.key!==e.key&&(null===(a=c.current)||void 0===a||a.cancel("Route Change"),c.current=null,r((e=>e.locationKey||e.pageData?{locationKey:void 0,pageData:null}:e))),d.current[t.location.pathname]&&(document.title=d.current[t.location.pathname])})))),[t]),(0,s.useEffect)((()=>{"string"==typeof(null==a?void 0:a._title)&&(document.title=d.current[t.location.pathname]=a._title)}),[t,a]);const f=(0,s.useCallback)((()=>{if(c.current)return c.current.listeners++,c.current.unlisten;o(!0);let e=()=>{};return(0,u.default)({cancelCb:t=>e=t}).then((e=>{r({locationKey:t.location.key,pageData:e})})).catch((e=>{console.error("Unable to fetch page data: ",e)})).finally((()=>{c.current=null,o(!1)})),c.current={listeners:1,unlisten(){this.listeners--,this.listeners<=0&&this.cancel("Orphan")},cancel:e,key:t.location.key},c.current.unlisten=c.current.unlisten.bind(c.current),c.current.unlisten}),[t]);return(0,s.useMemo)((()=>({pageData:a,locationKey:n,fetch:f,fetching:i})),[a,n,f,i])},t.default=function(e=!0,n=!0){const a=(0,l.useLocation)().key,{pageData:r,fetch:i,locationKey:o,fetching:u}=(0,s.useContext)(t.PageDataContext),c=(0,s.useRef)(!1);return o===a&&n&&(c.current=!0),(0,s.useEffect)((()=>e&&a!==o?i():void 0),[i,e,a,o]),a===o||c.current?[r,u,i]:[null,u,i]}},785:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostsCacheProvider=t.PostsCacheContext=void 0;const l=i(n(6689)),u=n(3308),c=s(n(2167)),d=n(9261),f=s(n(4927)),p=s(n(3112)),h={key:null,posts:[],page:0,pageSize:1,total:null,tags:{},fresh:!0};t.PostsCacheContext=l.default.createContext({}),t.PostsCacheProvider=function({children:e}){const n=(0,l.useRef)({});return l.default.createElement(t.PostsCacheContext.Provider,{value:n.current},e)},t.default=function(){const e=(0,u.useLocation)(),n=(0,u.useHistory)(),a=(0,l.useRef)(null),[r,i]=(0,l.useState)(!1),s=(0,l.useContext)(t.PostsCacheContext),E=(0,d.qsParse)(e.search),m="string"==typeof E.query?E.query:"",g=JSON.stringify([E.page,m]),[_,O]=(0,p.default)(!s[g],!1);let I=h;s[g]?I=s[g]:_&&(I=s[g]=Object.assign({key:g,page:1,tags:{},fresh:!0},_.results));const[v,b]=(0,l.useState)(I);(0,l.useEffect)((()=>{s[g]&&v!==s[g]&&(v.key&&(s[v.key].fresh=!1),b(s[g]))}),[v,_,s,g]),(0,l.useEffect)((()=>n.listen((()=>{a.current&&a.current(),a.current=null}))),[n]);const A=(0,l.useCallback)((()=>o(this,void 0,void 0,(function*(){if(!a.current&&!O&&s[g])try{if(null!==s[g].total&&s[g].posts.length>=(s[g].total||0))return;i(!0);const e=yield(0,f.default)({pathname:"/api/post",search:{query:m,page:s[g].page,blurhash:!0},cancelCb:e=>a.current=e});s[g]=Object.assign(Object.assign({},s[g]),{page:s[g].page+1,posts:[...s[g].posts,...e.posts],total:0===e.posts.length?s[g].posts.length:s[g].total,fresh:!1}),b(s[g])}catch(e){if(!(e instanceof c.default.Cancel))throw e}finally{a.current=null,i(!1)}}))),[O,s,g,m]),y=(0,l.useCallback)((()=>{s[g]=_?Object.assign({key:g,page:1,tags:{},fresh:!1},_.results):h,b(s[g])}),[g,_,s]);return{postsCache:v,fetching:r,requestNext:A,reset:y}}},8331:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.QueryProvider=t.useRTQuery=t.URLQueryContext=t.RTQueryContext=void 0;const s=i(n(6689)),l=n(3308),u=n(9261),c=o(n(3776));t.RTQueryContext=s.default.createContext(["",()=>{},()=>""]),t.URLQueryContext=s.default.createContext(["",()=>{},()=>""]),t.default=function(){return(0,s.useContext)(t.URLQueryContext)},t.useRTQuery=function(){return(0,s.useContext)(t.RTQueryContext)},t.QueryProvider=function({children:e}){const n=(0,l.useHistory)(),a=(0,u.qsParse)((0,l.useLocation)().search),r="string"==typeof a.query?a.query:"",[i,o]=(0,s.useState)(r),d=(0,s.useRef)(i);d.current=i,(0,c.default)(r,(e=>{e!==i&&o(e)}));const f=(0,s.useCallback)((e=>{let t="";t="function"==typeof e?e(d.current):e;const a=(0,u.qsParse)(n.location.search);return a.query=t,a.query||delete a.query,`${n.location.pathname}${(0,u.qsStringify)(a)}`}),[n]),p=(0,s.useCallback)(((e,t)=>{if(t)o(e);else{const t=f(e);n.push(t)}}),[n,f]),h=(0,s.useMemo)((()=>[i,p,f]),[i,p,f]),E=(0,s.useMemo)((()=>[r,p,f]),[r,p,f]);return s.default.createElement(t.RTQueryContext.Provider,{value:h},s.default.createElement(t.URLQueryContext.Provider,{value:E},e))}},4513:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SSRProvider=t.SSRContext=void 0;const o=i(n(6689));t.SSRContext=o.default.createContext(!0),t.default=function(){return(0,o.useContext)(t.SSRContext)},t.SSRProvider=function({children:e}){const[n,a]=(0,o.useState)(!0);return(0,o.useEffect)((()=>{a(!1)}),[]),o.default.createElement(t.SSRContext.Provider,{value:n},e)}},8144:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeProvider=t.ThemeContext=t.Theme=void 0;const s=i(n(6689));var l;function u(e,t){const n=new Date;n.setFullYear(n.getFullYear()+1),document.cookie=`${e}=${t}; expires=${n.toUTCString()}; path=/; SameSite=Lax`}!function(e){e.AUTO="auto",e.LIGHT="light",e.DARK="dark"}(l=t.Theme||(t.Theme={})),t.ThemeContext=s.default.createContext([l.LIGHT,()=>{}]),t.default=function(){return(0,s.useContext)(t.ThemeContext)},t.ThemeProvider=function({init:e=l.LIGHT,children:n}){const[a,r]=(0,s.useState)(e),i=(0,s.useCallback)((e=>o(this,void 0,void 0,(function*(){document.documentElement.classList.remove(...Object.values(l)),document.documentElement.classList.add(e),u("theme",e),r(e)}))),[]);return(0,s.useEffect)((()=>{const e=function(e){const t=`; ${document.cookie}`.split("; theme=");return 2===t.length?t.pop().split(";").shift():""}();e&&u("theme",e)}),[]),s.default.createElement(t.ThemeContext.Provider,{value:[a,i]},n)}},455:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(6689)),i=a(n(4749)),o=a(n(7715));t.default=function(){return r.default.createElement(i.default,null,r.default.createElement(o.default,{count:1}),r.default.createElement(o.default,{count:2}),r.default.createElement(o.default,{count:3}),r.default.createElement(o.default,{count:4}),r.default.createElement(o.default,{count:5}),r.default.createElement(o.default,{count:6}),r.default.createElement(o.default,{count:7}),r.default.createElement(o.default,{count:8}),r.default.createElement(o.default,{count:9}),r.default.createElement(o.default,{count:10}),r.default.createElement(o.default,{count:11}),r.default.createElement(o.default,{count:12}),r.default.createElement(o.default,{count:13}))}},1255:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(6689)),i=n(4661),o=a(n(4749));n(5206),t.default=function(){return r.default.createElement(o.default,{className:"NotFoundPage"},r.default.createElement("h1",null,"Page Not Found"),r.default.createElement(i.Link,{to:"/posts"},"See All Posts"))}},7452:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(4661),u=o(n(3112)),c=o(n(5520)),d=o(n(7856)),f=o(n(5386)),p=o(n(2044)),h=o(n(385)),E=o(n(8144)),m=o(n(3776));n(7563),t.default=function(){const[e,,t]=(0,u.default)(),n=(0,c.default)(),[a]=(0,E.default)(),[r,i]=(0,s.useState)(!0);return(0,m.default)(a,(()=>{i(!1),t()})),(0,m.default)(e,(()=>{i(!0)})),s.default.createElement("div",{className:"IndexPage"},n.expectMotd&&s.default.createElement("div",{className:"motdWrap"},r&&(null==e?void 0:e.motd)&&s.default.createElement(h.default,{post:e.motd,link:`/posts/${e.motd.id}`,controls:!1,muted:!0})),s.default.createElement("div",{className:"header"},s.default.createElement(l.Link,{to:"/posts"},n.appName)),s.default.createElement("div",{className:"links"},s.default.createElement(l.Link,{to:"/posts"},"All Posts"),s.default.createElement(l.Link,{to:"/tags"},"Tags"),s.default.createElement("a",{href:"/random"},"Random"),s.default.createElement("a",{href:"https://github.com/funmaker/hybooru",target:"_blank",rel:"noreferrer"},"GitHub"),s.default.createElement(p.default,null)),s.default.createElement(d.default,{className:"search",action:"/posts"},s.default.createElement(f.default,{name:"query",placeholder:"Search: flower sky 1girl"}),s.default.createElement("button",null,"Search")),e&&s.default.createElement("div",{className:"stats"},s.default.createElement("div",null,"Posts: ",s.default.createElement("span",null,e.stats.posts)),s.default.createElement("div",null,"Tags: ",s.default.createElement("span",null,e.stats.tags)),s.default.createElement("div",null,"Mappings: ",s.default.createElement("span",null,e.stats.mappings)),s.default.createElement("div",null,s.default.createElement(l.Link,{to:`/posts?query=${encodeURIComponent(n.untaggedQuery)}`},"Untagged: ",s.default.createElement("span",null,e.stats.needsTags)))),s.default.createElement("div",{className:"footer"},"Running ",s.default.createElement("a",{href:"https://github.com/funmaker/hybooru",target:"_blank",rel:"noreferrer"},"HyBooru")," v",n.version,(null==e?void 0:e.updateUrl)&&s.default.createElement("a",{className:"updateInfo",href:e.updateUrl,target:"_blank",rel:"noreferrer"},"(Update Avaliable)")," ",s.default.createElement("br",null),"Original concept by ",s.default.createElement("a",{href:"https://danbooru.donmai.us/",target:"_blank",rel:"noreferrer"},"Danbooru")))}},385:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=i(n(6689)),u=n(2854),c=n(9261),d=s(n(5520)),f=s(n(4513)),p=s(n(4855));function h({className:e,width:t,height:n,link:a,notes:r,children:i}){const o=void 0!==t&&void 0!==n?{aspectRatio:`${t} / ${n}`}:void 0,s=null==r?void 0:r.map(((e,t)=>{var n,a,r,i;return l.default.createElement("div",{key:t,className:"note","data-content":e.note,style:{left:`${(null===(n=e.rect)||void 0===n?void 0:n.left)||0}%`,top:`${(null===(a=e.rect)||void 0===a?void 0:a.top)||0}%`,width:`${(null===(r=e.rect)||void 0===r?void 0:r.width)||0}%`,height:`${(null===(i=e.rect)||void 0===i?void 0:i.height)||0}%`}})}));return a?l.default.createElement("a",{className:(0,c.classJoin)("File",e),style:o,href:a},i,s):l.default.createElement("div",{className:(0,c.classJoin)("File",e),style:o},i,s)}n(4751),t.default=function(e){var{post:t,link:n,className:a,controls:r=!0,autoPlay:i=!0,muted:s}=e,E=o(e,["post","link","className","controls","autoPlay","muted"]);const m=(0,d.default)(),g=(0,f.default)(),[_,O]=(0,l.useReducer)((()=>!0),!1),I="width"in t&&t.width||void 0,v="height"in t&&t.height||void 0,b=t.size&&(0,c.parseSize)(t.size);a=a?` ${a}`:"";let A=t.mime;(_||t.size&&t.size>m.maxPreviewSize||t.mime===u.Mime.APPLICATION_FLASH&&g)&&(A=u.Mime.GENERAL_APPLICATION);const y="notes"in t?t.notes.filter((e=>!!e.rect)):void 0;switch(A){case u.Mime.IMAGE_JPEG:case u.Mime.IMAGE_PNG:case u.Mime.IMAGE_GIF:case u.Mime.IMAGE_BMP:case u.Mime.IMAGE_ICON:case u.Mime.ANIMATION_GIF:case u.Mime.ANIMATION_APNG:case u.Mime.UNDETERMINED_PNG:case u.Mime.IMAGE_WEBP:case u.Mime.IMAGE_TIFF:case u.Mime.IMAGE_SVG:case u.Mime.IMAGE_HEIF:case u.Mime.IMAGE_HEIF_SEQUENCE:case u.Mime.IMAGE_HEIC:case u.Mime.IMAGE_HEIC_SEQUENCE:case u.Mime.IMAGE_AVIF:case u.Mime.IMAGE_AVIF_SEQUENCE:case u.Mime.UNDETERMINED_GIF:case u.Mime.IMAGE_QOI:case u.Mime.GENERAL_IMAGE:return l.default.createElement(h,{className:a,width:I,height:v,link:n,notes:y},l.default.createElement("img",Object.assign({className:"image",src:(0,u.fileUrl)(t),alt:String(t.id),width:I,height:v,onError:O},E)));case u.Mime.VIDEO_FLV:case u.Mime.VIDEO_MP4:case u.Mime.VIDEO_WMV:case u.Mime.VIDEO_MKV:case u.Mime.VIDEO_WEBM:case u.Mime.UNDETERMINED_WM:case u.Mime.VIDEO_MPEG:case u.Mime.VIDEO_MOV:case u.Mime.VIDEO_AVI:case u.Mime.VIDEO_REALMEDIA:case u.Mime.VIDEO_OGV:case u.Mime.UNDETERMINED_MP4:case u.Mime.GENERAL_VIDEO:case u.Mime.GENERAL_ANIMATION:return l.default.createElement(h,{className:a,width:I,height:v,link:r?void 0:n,notes:y},l.default.createElement("video",Object.assign({className:"video",controls:r,autoPlay:i,loop:!0,muted:s,width:I,height:v,onError:O},E),l.default.createElement("source",{src:(0,u.fileUrl)(t)}),"Your browser does not support this video."));case u.Mime.AUDIO_MP3:case u.Mime.AUDIO_OGG:case u.Mime.AUDIO_FLAC:case u.Mime.AUDIO_WMA:case u.Mime.AUDIO_M4A:case u.Mime.AUDIO_REALMEDIA:case u.Mime.AUDIO_TRUEAUDIO:case u.Mime.AUDIO_WAVE:case u.Mime.AUDIO_MKV:case u.Mime.AUDIO_MP4:case u.Mime.AUDIO_WAVPACK:case u.Mime.GENERAL_AUDIO:return l.default.createElement(h,{className:a,notes:y},l.default.createElement("audio",Object.assign({className:"audio",src:(0,u.fileUrl)(t),autoPlay:i&&!s,loop:!0,controls:!0,onError:O},E)));case u.Mime.APPLICATION_FLASH:return l.default.createElement(h,{className:a,width:I,height:v},l.default.createElement(p.default,{url:(0,u.fileUrl)(t),width:I,height:v}));case u.Mime.TEXT_HTML:case u.Mime.TEXT_PLAIN:case u.Mime.APPLICATION_JSON:case u.Mime.APPLICATION_YAML:case u.Mime.APPLICATION_HYDRUS_CLIENT_COLLECTION:case u.Mime.APPLICATION_CLIP:case u.Mime.APPLICATION_OCTET_STREAM:case u.Mime.APPLICATION_UNKNOWN:case u.Mime.APPLICATION_PDF:case u.Mime.APPLICATION_ZIP:case u.Mime.APPLICATION_HYDRUS_ENCRYPTED_ZIP:case u.Mime.APPLICATION_HYDRUS_UPDATE_DEFINITIONS:case u.Mime.APPLICATION_HYDRUS_UPDATE_CONTENT:case u.Mime.APPLICATION_RAR:case u.Mime.APPLICATION_7Z:case u.Mime.APPLICATION_PSD:case u.Mime.APPLICATION_CBOR:case u.Mime.APPLICATION_WINDOWS_EXE:case u.Mime.APPLICATION_SAI2:case u.Mime.APPLICATION_KRITA:case u.Mime.APPLICATION_XCF:case u.Mime.APPLICATION_GZIP:case u.Mime.APPLICATION_PROCREATE:case u.Mime.GENERAL_APPLICATION_ARCHIVE:case u.Mime.GENERAL_IMAGE_PROJECT:case u.Mime.GENERAL_APPLICATION:default:return l.default.createElement(h,{className:a,link:n,notes:y},l.default.createElement("div",{className:"unknown","data-ext":t.extension.slice(1),"data-size":b},l.default.createElement("img",Object.assign({src:"/static/file.svg",alt:String(t.id)},E))))}}},1678:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(6918),u=n(2854),c=n(9261),d=o(n(3112)),f=o(n(8394)),p=o(n(5520)),h=o(n(4749)),E=o(n(7925)),m=o(n(7719)),g=o(n(1255)),_=o(n(385)),O=o(n(2149));n(3158);const I={[l.Relation.ALTERNATE]:"Alternative",[l.Relation.DUPLICATE]:"Duplicate",[l.Relation.DUPLICATE_BEST]:"Duplicate (best)"};t.default=function(){const{ratingStars:e}=(0,p.default)(),[t]=(0,d.default)(),[n]=(0,f.default)("fullHeight",!1),a=(0,s.useMemo)((()=>(null==t?void 0:t.post)?[...t.post.relations,t.post].sort(((e,t)=>e.id-t.id)):[]),[null==t?void 0:t.post]);if(!t)return s.default.createElement(h.default,{className:"PostPage"});if(!t.post)return s.default.createElement(g.default,null);const r=(0,u.fileUrl)(t.post);let i;if(null!==e)if(null!==t.post.rating){const n=Math.round(t.post.rating*e);i=s.default.createElement("div",{className:"rating"},s.default.createElement("span",{className:"gold"},"★".repeat(n)),s.default.createElement("span",{className:"gray"},"☆".repeat(e-n)))}else i=s.default.createElement("div",{className:"rating"},s.default.createElement("span",{className:"gray"},"★".repeat(e)));const o=t.post.notes.filter((e=>!e.rect));return s.default.createElement(h.default,{className:"PostPage"+(n?" fullHeight":""),simpleSettings:!0,sidebar:s.default.createElement(s.default.Fragment,null,i,s.default.createElement("div",{className:"namespace"},s.default.createElement("b",null,"Statistics"),s.default.createElement("div",null,null!==t.post.size&&`Size: ${(0,c.parseSize)(t.post.size)}`),s.default.createElement("div",null,null!==t.post.width&&null!==t.post.height&&`Dimensions: ${t.post.width}x${t.post.height}`),s.default.createElement("div",null,null!==t.post.mime&&u.MIME_STRING[t.post.mime]&&`Mime: ${u.MIME_STRING[t.post.mime]}`),s.default.createElement("div",null,null!==t.post.duration&&`Duration: ${(0,c.parseDuration)(t.post.duration)}`),s.default.createElement("div",null,null!==t.post.nunFrames&&`Frames: ${t.post.nunFrames}`),s.default.createElement("div",null,null!==t.post.hasAudio&&"Audio: "+(t.post.hasAudio?"Yes":"No")),s.default.createElement("div",null,"Posted: ",new Date(t.post.posted).toLocaleString()),t.post.inbox&&s.default.createElement("div",null,"In inbox"),t.post.trash&&s.default.createElement("div",null,"In trash"),s.default.createElement("div",null,s.default.createElement("b",null,s.default.createElement("a",{href:r,target:"_blank",rel:"noreferrer",download:!0},"Download This File")))),t.post.sources.length>0&&s.default.createElement("div",{className:"namespace"},s.default.createElement("b",null,"Sources"),t.post.sources.map((e=>s.default.createElement(O.default,{key:e,url:e})))),s.default.createElement(m.default,{tags:t.post.tags,grouped:!0}),o.map(((e,t)=>s.default.createElement("div",{className:"namespace spaced note",key:t},s.default.createElement("b",null,e.label),s.default.createElement("p",null,e.note)))))}," ",s.default.createElement("div",{className:"fileWrap"},s.default.createElement(_.default,{post:t.post,link:r})),t.post.relations.length>0&&s.default.createElement("div",{className:"relations"},a.map((e=>s.default.createElement(E.default,{key:e.id,id:e.id,post:e,label:"kind"in e?I[e.kind]:s.default.createElement("b",null,"This Post"),noFade:!0})))))}},2149:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(6689)),i=/^(?:https?:\/\/)?([^/]+)/;t.default=function({url:e}){const t=e.match(i),n=t&&Object.keys(o).find((e=>t[1].endsWith(e)));let a;return a=n?o[n]:t&&t[1]||e,r.default.createElement("div",null,r.default.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},a))};const o={"8ch.net":"8chan","8chan.moe":"8chan.moe","8kun.top":"8kun","a.4cdn.org":"4chan","api.420chan.org":"420chan","artstation.com":"ArtStation","backend.deviantart.com":"Deviant Art","boards.420chan.org":"420chan Thread","boards.4chan.org":"4chan Thread","boards.4channel.org":"4channel Thread","chan.sankakucomplex.com":"Sankaku Channel","danbooru.donmai.us":"Danbooru","derpibooru.org":"Derpibooru","deviantart.com":"Deviant Art","e621.net":"e621","furry.booru.org":"FurryBooru","gelbooru.com":"Gelbooru","gfycat.com":"Gfycat","i.4cdn.org":"4chan","i.imgur.com":"Imgur","i.warosu.org":"Warosu","idol.sankakucomplex.com":"Sankaku Idol","imgur.com":"Imgur","inkbunny.net":"Inkbunny","konachan.com":"Konachan","newgrounds.com":"Newgrounds","nijie.info":"Nijie","nitter.eu":"nitter","nitter.net":"nitter","nitter.nixnet.services":"nitter","pixiv.net":"pixiv","prolikewoah.com":"ProLikeWoah","realbooru.com":"Realbooru","rule34.paheal.net":"Rule 34","rule34.xxx":"Rule 34","rule34hentai.net":"Rule 34 Hentai","safebooru.org":"Safebooru","sakugabooru.com":"Sakugabooru","sandbox.deviantart.com":"Deviant Art","smuglo.li":"smuglo.li","tbib.org":"The Big Imageboard","tumblr.com":"Tumblr","tvch.moe":"tvchan","twitter.com":"Twitter","vch.moe":"vch.moe","warosu.org":"Warosu","www.hentai-foundry.com":"Hentai Foundry","xbooru.com":"Xbooru","yande.re":"yande.re","yiff.party":"Yiff.Party","booru.funmaker.moe":"Mikubooru","discordapp.com":"Discord"}},8327:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(4661),u=n(3308),c=o(n(3112)),d=o(n(4749)),f=o(n(7165));n(7359),t.default=function(){const[e,t]=(0,c.default)(),n=(0,u.useHistory)();return(0,s.useEffect)((()=>{e&&n.replace(e.redirect||"/")}),[n,t,e]),s.default.createElement(d.default,{className:"RandomPage"},s.default.createElement(f.default,null),s.default.createElement(l.Link,{to:"/"},"Back to Main Page"))}},1040:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(3308),u=n(4661),c=o(n(385));n(2984),t.default=function({posts:e,id:t,setId:n}){const[a,r]=(0,s.useReducer)((e=>!e),!0),i=(0,l.useHistory)(),o=(0,s.useRef)(0),d=(0,s.useRef)(0),f=(0,s.useRef)(!1),p=(0,s.useRef)(new Map),h=(0,s.useRef)(Date.now()),E=(0,s.useRef)(null),m=(0,s.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),Math.abs(o.current)<1&&n(null)}),[n]),g=(0,s.useCallback)((e=>{if(e.stopPropagation(),e.preventDefault(),Math.abs(o.current)<1){const t=e.currentTarget;let a=!1;if(t instanceof HTMLImageElement){let n=t.naturalWidth||t.width,r=t.naturalHeight||t.height;const i=t.getBoundingClientRect();n>i.width&&(r*=i.width/n,n=i.width),r>i.height&&(n*=i.height/r,r=i.height),(t.width-n)/2>e.clientX-i.x&&(a=!0),(t.width+n)/2<e.clientX-i.x&&(a=!0),(t.height-r)/2>e.clientY-i.y&&(a=!0),(t.height+r)/2<e.clientY-i.y&&(a=!0)}a?n(null):r()}}),[n]),_=(0,s.useCallback)((e=>{f.current||(e.currentTarget.setPointerCapture(e.pointerId),f.current=!0,p.current.set(e.pointerId,[e.clientX,e.clientY]))}),[]),O=(0,s.useCallback)((e=>{e.currentTarget.releasePointerCapture(e.pointerId),f.current=!1}),[]),I=(0,s.useCallback)((e=>{if(!f.current)return;const t=p.current.get(e.pointerId),n=e.clientX-t[0];d.current=n/window.innerWidth*100/(Date.now()-h.current),o.current+=n/window.innerWidth*100,h.current=Date.now(),p.current.set(e.pointerId,[e.clientX,e.clientY])}),[]),v=(0,s.useCallback)((()=>n(null)),[n]),b=null!==t&&t-1>=0,A=null!==t&&t+1<e.length;if((0,s.useEffect)((()=>{if(null===t)return;let e;const a=()=>{if(e=requestAnimationFrame(a),E.current){if(!f.current){const e=o.current/10+10*d.current;e<-1&&A?o.current=Math.max(-100,o.current-Math.max(5,(100+o.current)/5)):e>1&&b?o.current=Math.min(100,o.current+Math.max(5,(100-o.current)/5)):o.current<0?o.current=Math.min(0,o.current+Math.max(1,-o.current/10)):o.current>0&&(o.current=Math.max(0,o.current-Math.max(1,o.current/10))),(o.current>=100&&b||o.current<=-100&&A)&&(n(t-Math.sign(o.current)),o.current=0,d.current=0)}E.current.style.left=`${o.current}vw`}};return e=requestAnimationFrame(a),()=>cancelAnimationFrame(e)}),[b,A,t,n]),(0,s.useEffect)((()=>{if(null===t)return;const a=a=>{"ArrowLeft"===a.key&&b?n(t-1):"ArrowRight"===a.key&&A?n(t+1):"Enter"===a.key?i.push(`/posts/${e[t].id}`):"Escape"===a.key&&n(null)},r=e=>{e.preventDefault(),e.deltaY<0&&b?n(t-1):e.deltaY>0&&A&&n(t+1)};return document.documentElement.addEventListener("keydown",a),document.documentElement.addEventListener("wheel",r),()=>{document.documentElement.removeEventListener("keydown",a),document.documentElement.removeEventListener("wheel",r)}}),[i,e,t,n,b,A]),null===t||!e[t])return null;const y=b?e[t-1]:null,T=e[t],N=A?e[t+1]:null;return s.default.createElement("div",{className:"GalleryPopup",style:{left:`${o.current}vw`},ref:E},s.default.createElement("div",{className:"header"+(a?" open":"")},s.default.createElement("div",{className:"closeBtn",onClick:v},"✕"),s.default.createElement(u.Link,{to:`/posts/${T.id}`,className:"moreBtn"},"Open Post")),y&&s.default.createElement("div",{key:y.id,className:"wrap left"},s.default.createElement(c.default,{post:y,draggable:!1,controls:!1,muted:!0}))," ",s.default.createElement("div",{key:T.id,className:"wrap",onClick:m,onPointerDown:_,onPointerUp:O,onPointerMove:I},s.default.createElement(c.default,{post:T,draggable:!1,controls:!1,onClickCapture:g,autoPlay:!0})),N&&s.default.createElement("div",{key:N.id,className:"wrap right"},s.default.createElement(c.default,{post:N,draggable:!1,controls:!1,muted:!0})))}},3850:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__rest||function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=i(n(6689)),u=n(3308),c=n(9261),d=s(n(8394)),f=s(n(4513)),p=s(n(785)),h=s(n(4749)),E=s(n(7719)),m=s(n(7925)),g=s(n(7715)),_=s(n(7165)),O=s(n(1040));n(9107),t.default=function(){var e;const{postsCache:t,fetching:n,requestNext:a,reset:r}=(0,p.default)(),[i]=(0,d.default)("pagination",!1),[o]=(0,d.default)("popup",!1),s=(0,f.default)(),m=(0,u.useHistory)(),v=(0,c.qsParse)(m.location.search),b=(0,l.useRef)(t),A=(0,l.useRef)(!1),y=(0,l.useRef)(null),T=!!(null===(e=b.current)||void 0===e?void 0:e.key)&&b.current.key!==t.key&&!t.fresh;b.current=t;const N=i||s||void 0!==v.page,P=Math.ceil((t.total||0)/t.pageSize),R=t.total&&t.posts.length>=t.total;let M=parseInt(m.location.hash.slice(1));(isNaN(M)||M>=t.posts.length||s)&&(M=null),(0,l.useEffect)((()=>m.listen(((e,t)=>{requestAnimationFrame((()=>{null!==y.current&&(document.documentElement.scrollTop=y.current,y.current=null)})),"POP"===t&&A.current&&(A.current=!1)}))),[m]);const L=(0,l.useCallback)((e=>{var t,n;if(A.current&&null===e?(y.current=document.documentElement.scrollTop,m.goBack(),A.current=!1):A.current&&null!==e?m.replace(Object.assign(Object.assign({},m.location),{hash:e.toString()})):null===e||m.location.hash?m.replace(Object.assign(Object.assign({},m.location),{hash:""})):(m.push(Object.assign(Object.assign({},m.location),{hash:e.toString()})),A.current=!0),null!==e&&(null===(t=b.current)||void 0===t?void 0:t.posts[e])){const t=b.current.posts[e].id;null===(n=document.getElementById(t.toString()))||void 0===n||n.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}),[m]);(0,l.useEffect)((()=>{const e=parseInt(m.location.hash.slice(1));m.location.hash&&null===M&&m.replace(Object.assign(Object.assign({},m.location),{hash:""})),s&&e&&L(e)}),[m,M,s,L]);const C=(0,l.useCallback)((()=>{if(N)return;const e=document.body,t=document.documentElement,n=window.pageYOffset+window.innerHeight;Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)-n<.25*window.innerHeight&&a()}),[a,N]),S=(0,l.useCallback)(((e,t)=>{o&&(e.preventDefault(),L(t))}),[o,L]);(0,l.useEffect)((()=>C()),[C,t]),(0,l.useEffect)((()=>(C(),document.addEventListener("scroll",C),window.addEventListener("resize",C),()=>{document.removeEventListener("scroll",C),window.removeEventListener("resize",C)})),[C]),(0,l.useEffect)((()=>{i||void 0===v.page?i&&t.page>1&&r():m.replace((0,c.qsStringify)(Object.assign(Object.assign({},v),{page:void 0})))}),[m,i,t.page,r,v]);let D=l.default.createElement("div",{className:"bottomPad"+(R?" end":"")});return N?D=l.default.createElement(g.default,{count:P}):n&&(D=l.default.createElement(_.default,null)),l.default.createElement(h.default,{className:"SearchPage",dimmed:null!==M,extraLink:null!==t.total&&l.default.createElement("div",{className:"total"},"Results: ",t.total),sidebar:l.default.createElement(E.default,{tags:t.tags,searchMod:!0})},l.default.createElement("div",{className:"posts"},l.default.createElement(I,{posts:t.posts,noFade:T,onClick:S}),new Array(16).fill(null).map(((e,t)=>l.default.createElement("div",{key:t,className:"placeholder"})))),D,l.default.createElement(O.default,{posts:t.posts,id:M,setId:L}))};const I=l.default.memo((function(e){var{posts:t}=e,n=o(e,["posts"]);return l.default.createElement(l.default.Fragment,null,t.map(((e,t)=>l.default.createElement(m.default,Object.assign({key:e.id},n,{id:t,post:e,useId:!0})))))}))},6651:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(6689)),l=n(4661),u=n(2854),c=o(n(4749)),d=o(n(7715)),f=o(n(3112)),p=o(n(5520)),h=o(n(8394));function E({tag:e,showNamespaces:t}){const n=e.name.match(u.namespaceRegex);return s.default.createElement("tr",null,s.default.createElement("td",null,e.posts),s.default.createElement("td",null,s.default.createElement(m,{tag:e.name,showNamespaces:t})),s.default.createElement("td",null,n?n[1]:"General"),s.default.createElement("td",null,e.parents.map(((e,n)=>s.default.createElement(s.default.Fragment,null,0!==n&&", ",s.default.createElement(m,{key:e,tag:e,showNamespaces:t}))))),s.default.createElement("td",null,e.siblings.map(((e,n)=>s.default.createElement(s.default.Fragment,null,0!==n&&", ",s.default.createElement(m,{key:e,tag:e,showNamespaces:t}))))))}function m({tag:e,showNamespaces:t}){const n=(0,p.default)();let a,r=e.replace(/_/g," ");const i=e.match(u.namespaceRegex);return i&&(t||(r=i[2]),a=n.namespaceColors[i[1]]),s.default.createElement(l.Link,{to:`/posts?query=${encodeURIComponent(e)}`,style:{color:a}},r)}n(8198),t.default=function(){const[e]=(0,h.default)("namespaces",!1);let[t]=(0,f.default)();const n=(0,s.useRef)(t);t?n.current=t:t=n.current;const a=t&&Math.ceil(t.results.total/t.results.pageSize);return console.log(t),s.default.createElement(c.default,{className:"TagsPage",searchAction:"/tags",random:!1,simpleSettings:!0},s.default.createElement("table",{className:"tags"},s.default.createElement("thead",null,s.default.createElement("tr",null,s.default.createElement("th",null,"Posts"),s.default.createElement("th",null,"Name"),s.default.createElement("th",null,"Namespace"),s.default.createElement("th",null,"Parents"),s.default.createElement("th",null,"Siblings"))),s.default.createElement("tbody",null,null==t?void 0:t.results.tags.map((t=>s.default.createElement(E,{key:t.name,tag:t,showNamespaces:e}))))),!!a&&s.default.createElement(d.default,{count:a}))}},8676:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(3501);const r=a(n(3685)),i=a(n(5022)),o=a(n(9827)),s=a(n(5946));"boolean"==typeof s.default.isTTY&&(i.default.level=s.default.isTTY?i.default.level||1:0);let l=s.default.port||3e3;process.env.PORT&&(l=parseInt(process.env.PORT)||l);let u=s.default.host||"0.0.0.0";process.env.HOST&&(u=process.env.HOST);const c=r.default.createServer(o.default);o.default,o.default,c.listen({port:l,host:u}),console.log(`\n${i.default.bold("HyBooru")} started on port ${i.default.yellow.bold(""+l)}`),console.log(`Environment: ${i.default.yellow.bold("production")}.`),console.log(i.default.dim.white("Press Ctrl-C to terminate.\n")),process.on("unhandledRejection",((e,t)=>{console.log("Unhandled Rejection at: Promise",t,"reason:",e)}))},9827:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(3685)),l=o(n(6860)),u=o(n(3986)),c=o(n(9710)),d=o(n(7455)),f=(o(n(9470)),o(n(338))),p=o(n(846)),h=o(n(6015)),E=n(2779);n(2614);const m=(0,l.default)();m.use(u.default.urlencoded({extended:!1})),m.use(u.default.json()),m.use((0,c.default)()),m.use((0,d.default)()),m.use("/static",l.default.static("static")),m.use("/robots.txt",l.default.static("static/robots.txt")),m.use("/client.js",l.default.static("client.js")),m.use("/client.js.LICENSE.txt",l.default.static("client.js.LICENSE.txt")),m.use("/style.css",l.default.static("style.css")),m.use(p.default),m.use(f.default),m.use("/",E.router),m.use(((e,t,n)=>{n(new h.default(404))})),m.use(((e,t,n,a)=>{"EBADCSRFTOKEN"===e.code&&(e=new h.default(403,"Bad CSRF Token")),404!==e.HTTPcode&&console.error(e);const r=e.HTTPcode||500,i={code:r,message:e.publicMessage||s.STATUS_CODES[r]||"Something Happened",stack:void 0};n.status(r).react({_error:i})})),t.default=m},4694:function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getReleases=void 0;const i=n(6142),o=r(n(5946)),s=new i.Octokit;let l=null;t.getReleases=function(){return a(this,void 0,void 0,(function*(){if(!o.default.versionCheck||!o.default.versionCheck.enabled)return[];if(l&&Date.now()-l.created<o.default.versionCheck.cacheLifeMs)return l.releases;try{console.log("Fetching resources");const e=yield s.request("GET /repos/{owner}/{repo}/releases",{owner:o.default.versionCheck.owner,repo:o.default.versionCheck.repo,per_page:100});return l={releases:e.data,created:Date.now()},l.releases}catch(e){return console.error("Failed to fetch releases from GitHub."),console.error(e),[]}}))}},2482:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getStats=t.getConfig=void 0;const l=s(n(2419)),u=s(n(4147)),c=i(n(2614)),d=s(n(5946));t.getConfig=function(){return o(this,void 0,void 0,(function*(){const e=yield c.queryFirst(l.default`
    SELECT
      ARRAY[ global.thumbnail_width, global.thumbnail_height ] as "thumbnailSize",
      global.rating_stars as "ratingStars",
      json_object_agg(namespaces.name, namespaces.color) as "namespaceColors"
    FROM global
    CROSS JOIN namespaces
    GROUP BY global.id
  `);if(!e)throw new Error("Globals couldn't be fetched!");return Object.assign(Object.assign({},e),{appName:d.default.appName,version:u.default.version,expectMotd:!!d.default.tags.motd,untaggedQuery:d.default.tags.untagged,maxPreviewSize:d.default.posts.maxPreviewSize,passwordSet:!!d.default.adminPassword,thumbnailsMode:d.default.posts.thumbnailsMode})}))},t.getStats=function(){return o(this,void 0,void 0,(function*(){const e=yield c.queryFirst(l.default`
    SELECT
      posts,
      tags,
      mappings,
      needs_tags as "needsTags"
    FROM global
  `);if(!e)throw new Error("Globals couldn't be fetched!");return e}))}},7430:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.clearCache=t.get=t.random=t.search=void 0;const l=s(n(2419)),u=s(n(4471)),c=i(n(2614)),d=s(n(6015)),f=n(2854),p=n(5718),h=s(n(5946)),E=h.default.posts.pageSize*h.default.posts.cachePages,m=/^[_%]*%[_%]*$/,g={date:"posted",id:"id",score:"rating",size:"size"};function _(e){var t;const n=e.split(" ").filter((e=>!!e)).map(p.preparePattern);if(n.length>40)throw new d.default(400,"Query can have only up to 40 parts.");const a=[],r=[],i=[],o=[];let s,l,u,c=g.date,E="desc",m=null;for(let e of n)if(e.startsWith("system:")||e.startsWith("-system:"))"system:archive"===e||"-system:inbox"===e?l=!1:"system:inbox"===e||"-system:archive"===e?l=!0:"-system:trash"===e?u=!1:"system:trash"===e&&(u=!0);else if(e.startsWith("-"))r.push(e.slice(1));else if(e.startsWith("order:")){if(e=e.slice(6),e.endsWith("\\_asc")&&(E="asc",e=e.slice(0,-5)),e.endsWith("\\_desc")&&(E="desc",e=e.slice(0,-6)),!(e in g))throw new d.default(400,`Invalid sorting: ${e}, expected: ${Object.keys(g).join(", ")}`);c=g[e]}else if("rating:none"===e)s=null;else if(e.startsWith("sha256:")){let t=e.slice(7);t.startsWith("0x")&&(t=t.slice(2)),t.length%2!=0&&(t+="0"),i.push(`\\x${t}`)}else if(e.startsWith("md5:")){let t=e.slice(4);t.startsWith("0x")&&(t=t.slice(2)),t.length%2!=0&&(t+="0"),o.push(`\\x${t}`)}else if((null===(t=h.default.rating)||void 0===t?void 0:t.enabled)&&(m=e.match(f.rangeRatingRegex))){let e=parseInt(m[1]),t=parseInt(m[2]);if(void 0===m[2]&&(t=e),isNaN(e)||isNaN(t))continue;e>t&&([e,t]=[t,e]),s=[e/h.default.rating.stars-Number.EPSILON,t/h.default.rating.stars+Number.EPSILON]}else a.push(e);return{whitelist:a,blacklist:r,sha256:i,md5:o,sort:c,order:E,rating:s,inbox:l,trash:u,offset:0}}t.search=function({query:e="",page:t=0,tags:n=!1,hashes:a,blurhash:r,pageSize:i=h.default.posts.pageSize},s){return o(this,void 0,void 0,(function*(){i>h.default.posts.pageSize&&(i=h.default.posts.pageSize);const o=_(e),u=[];let d=t*i;const p=t*i+i;let m={},g=0;for(;d<p;){const e=Math.floor(d/E)*E,t=e+E;o.offset=e;const n=yield v(o,s);m=n.tags,g=n.total,u.push(...n.posts.slice(d-e,p-e)),d=t}let O=l.default``;a&&(O=O.append(l.default`
      'md5', encode(md5, 'hex'),
    `)),r&&(O=l.default`
      'blurhash', blurhash,
      'width', width,
      'height', height,
    `);const I=yield c.queryFirst(l.default`
    SELECT
      COALESCE(json_agg(json_build_object(
        'id', id,
        'sha256', encode(sha256, 'hex'),
        'hash', encode(sha256, 'hex'),
        `.append(O).append(l.default`
        'mime', mime,
        'posted', format_date(posted),
        'size', size
      ) ORDER BY rn), '[]') as posts
    FROM unnest(${u}::INTEGER[]) WITH ORDINALITY x(cached, rn)
    INNER JOIN posts ON id = cached
  `),s);I.pageSize=i,n&&(I.tags=m),I.total=g;for(const e of I.posts)e&&(e.extension=f.MIME_EXT[e.mime]||"");return I}))},t.random=function(e=null){return o(this,void 0,void 0,(function*(){let t;if(e){const n=_(e),a=yield v(n);t=a.posts[Math.floor(Math.random()*a.posts.length)]||null}else{const e=yield c.queryFirst(l.default`
      SELECT id
      FROM posts
      OFFSET floor(random() * (SELECT posts FROM global))
      LIMIT 1
    `);t=(null==e?void 0:e.id)||null}const n=yield c.queryFirst(l.default`
    SELECT
      id,
      encode(sha256, 'hex') as sha256,
      encode(sha256, 'hex') as hash,
      mime,
      format_date(posted) AS posted
    FROM posts
    WHERE id = ${t}
  `);return n&&(n.extension=f.MIME_EXT[n.mime]||""),n}))},t.get=function(e){return o(this,void 0,void 0,(function*(){const t=yield c.queryFirst(l.default`
    SELECT
      posts.id,
      encode(posts.sha256, 'hex') AS sha256,
      encode(posts.sha256, 'hex') AS hash,
      encode(posts.md5, 'hex') AS md5,
      posts.size,
      posts.width,
      posts.height,
      posts.duration,
      posts.num_frames AS "nunFrames",
      posts.has_audio AS "hasAudio",
      posts.rating,
      posts.mime,
      posts.inbox,
      posts.trash,
      format_date(posted) AS posted,
      COALESCE(json_object_agg(
        tags.name, tags.used
        ORDER BY name ASC, tags.id ASC
      ) FILTER (WHERE tags.id IS NOT NULL), '{}') AS tags,
      (
        SELECT COALESCE(array_agg(DISTINCT urls.url) FILTER (WHERE urls.id IS NOT NULL), '{}')
        FROM urls
        WHERE urls.postid = posts.id
      ) AS sources,
      (
        SELECT COALESCE(array_agg(json_build_object(
          'id', other.id,
          'sha256', encode(other.sha256, 'hex'),
          'hash', encode(other.sha256, 'hex'),
          'mime', other.mime,
          'posted', format_date(other.posted),
          'kind', relations.kind
        )) FILTER (WHERE relations.postid IS NOT NULL), '{}')
        FROM relations
        INNER JOIN posts other ON other.id = relations.other_postid
        WHERE relations.postid = posts.id
      ) AS relations,
      (
        SELECT COALESCE(array_agg(json_build_object(
          'label', notes.label,
          'note', notes.note,
          'rect', NULL
        )) FILTER (WHERE notes.postid IS NOT NULL), '{}')
        FROM notes
        WHERE notes.postid = posts.id
      ) AS notes
    FROM posts
    LEFT  JOIN mappings ON mappings.postid = posts.id
    LEFT  JOIN tags     ON mappings.tagid = tags.id
    WHERE posts.id = ${e}
    GROUP BY posts.id
  `);if(t){t.extension=f.MIME_EXT[t.mime]||"";for(const e of t.relations)e.extension=f.MIME_EXT[e.mime]||"";t.notes=t.notes.flatMap((e=>function(e){const t=[],n=/\n*(.*?)\n#! ([^\n]*)\n?/gs;try{let a;for(;a=n.exec(e.note);){const e=JSON.parse(a[2]);if(!Array.isArray(e))throw new Error(`Expected array, got ${a[2]}`);let[n,r,i,o,s,l]=e;"number"!=typeof n&&(n=0),"number"!=typeof r&&(r=0),"number"!=typeof i&&(i=0),"number"!=typeof o&&(o=0),"number"!=typeof s&&(s=100),"number"!=typeof l&&(l=100),t.push({label:null,note:a[1],rect:{left:n/s*100,top:r/l*100,width:i/s*100,height:o/l*100}})}}catch(e){return console.error("Unable to parse note position data data."),console.error(e),null}return t.length>0?t:null}(e)||[e]))}return t}))};const O=(0,u.default)({alg:"sha1",coerce:!1});let I={};function v(e,t){return o(this,void 0,void 0,(function*(){const n=O.hash(e);if(I[n])return I[n].lastUsed=Date.now(),I[n];let{whitelist:a,blacklist:r,sha256:i,md5:o,sort:s,order:u,offset:d,rating:f,inbox:p,trash:g}=e,_=l.default``,v=l.default`
    FROM filtered
    INNER JOIN posts ON posts.id = filtered.id
  `;const b=a.length>0&&a.every((e=>m.test(e))),A=r.some((e=>m.test(e)));a=a.filter((e=>!m.test(e))),r=r.filter((e=>!m.test(e)));const y=[];let T,N,P,R;if(a.length>0&&y.push(l.default`
      SELECT union_agg(tag_postids.postids) AS ids
      FROM unnest(${a}::TEXT[]) WITH ORDINALITY x(pat, patid)
      LEFT JOIN tags ON tags.name LIKE pat OR tags.subtag LIKE pat
      INNER JOIN tag_postids ON tag_postids.tagid = tags.id
      GROUP BY patid
    `),i.length>0&&y.push(l.default`
      SELECT array_agg(id) AS ids
      FROM posts
      WHERE sha256 = ANY(${i}::bytea[])
    `),o.length>0&&y.push(l.default`
      SELECT array_agg(id) AS ids
      FROM posts
      WHERE md5 = ANY(${o}::bytea[])
    `),y.length>0){const e=y.reduce(((e,t)=>e.append(l.default`UNION ALL`).append(t)));T=l.default`whitelist AS (
      SELECT intersection_agg(ids) as ids FROM (
        `.append(e).append(l.default`
      ) ids
    ),`)}else T=null;N=r.length>0?l.default`blacklist AS (
      SELECT union_agg(tag_postids.postids) AS ids
      FROM unnest(${r}::TEXT[]) pat
      LEFT JOIN tags ON tags.name LIKE pat OR tags.subtag LIKE pat
      INNER JOIN tag_postids ON tag_postids.tagid = tags.id
    ),`:null,P=b&&A?"WHERE FALSE":b?"WHERE EXISTS(SELECT 1 FROM mappings WHERE postid = id)":A?"WHERE NOT EXISTS(SELECT 1 FROM mappings WHERE postid = id)":"",b&&A?R=l.default`filtered AS (SELECT 0 AS id WHERE FALSE)`:T&&N?R=l.default`filtered AS (
      SELECT id
      FROM whitelist
      CROSS JOIN blacklist
      CROSS JOIN LATERAL unnest(whitelist.ids - blacklist.ids) id
      `.append(P).append("\n    )"):T?R=l.default`filtered AS (
      SELECT id
      FROM whitelist
      CROSS JOIN LATERAL unnest(whitelist.ids) id
      `.append(P).append("\n    )"):N?R=l.default`filtered AS (
      SELECT id
      FROM posts
      CROSS JOIN blacklist
      WHERE posts.id != ALL(blacklist.ids)
      `.append(P).append("\n    )"):P?R=l.default`filtered AS (
      SELECT id
      FROM posts
      `.append(P).append("\n    )"):(R=l.default`filtered AS (SELECT id FROM posts)`,v=l.default`FROM posts`),null===f?_=_.append(l.default` AND posts.rating IS NULL`):Array.isArray(f)&&(_=_.append(l.default` AND posts.rating BETWEEN ${f[0]} AND ${f[1]}`)),void 0!==p&&(_=_.append(l.default` AND posts.inbox = ${p}`)),void 0!==g&&(_=_.append(l.default` AND posts.trash = ${g}`));const M=yield c.queryFirst(l.default`
    WITH
      `.append(T||l.default``).append(l.default`
      `).append(N||l.default``).append(l.default`
      `).append(R).append(l.default`
    SELECT
      COALESCE(json_agg(id), '[]') as posts,
      (SELECT count(1) FROM filtered) as total,
      (
        SELECT
          COALESCE(json_object_agg(name, used), '{}')
        FROM (
          SELECT *
          FROM(
            SELECT
              tags.id,
              tags.name,
              tags.used,
              count(1) as count
            FROM (SELECT id FROM filtered LIMIT ${256}) filtered
            LEFT  JOIN mappings ON mappings.postid = filtered.id
            LEFT  JOIN tags     ON mappings.tagid = tags.id
            GROUP BY tags.id
          ) x
          WHERE id IS NOT NULL
          ORDER BY count DESC, id ASC
          LIMIT ${h.default.tags.searchSummary}
        ) x
      ) AS tags
    FROM (
      SELECT posts.*
      `).append(v).append(`\n      WHERE posts."${s}" IS NOT NULL\n      `).append(_).append(`\n      ORDER BY posts."${s}" ${u}, posts.id ${u}\n      `).append(l.default`
      LIMIT ${E}
      OFFSET ${d}
    ) x
  `),t);if(Object.keys(I).length>=h.default.posts.cacheRecords){let e=null,t=Date.now();for(const[n,a]of Object.entries(I))(null===e||t>a.lastUsed)&&(e=n,t=a.lastUsed);null!==e&&delete I[e]}return I[n]=Object.assign(Object.assign({},M),{lastUsed:Date.now()})}))}t.clearCache=function(){I={}}},605:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.search=void 0;const l=s(n(2419)),u=i(n(2614)),c=s(n(6015)),d=n(5718),f={id:"id",posts:"used"};t.search=function({query:e="",sorting:t,page:n=0,pageSize:a=50,full:r=!1}){return o(this,void 0,void 0,(function*(){a>50&&(a=50);let i=(0,d.preparePattern)(e.trim()),o=f.posts,s="desc";if(t){if(t.endsWith("\\_asc")&&(s="asc",t=t.slice(0,-5)),t.endsWith("\\_desc")&&(s="desc",t=t.slice(0,-6)),!(t in f))throw new c.default(400,`Invalid sorting: ${t}, expected: ${Object.keys(f).join(", ")}`);o=f[t]}""===i&&(i="%");const p=yield u.queryFirst(l.default`
    WITH filtered AS (
          SELECT DISTINCT ON (id)
            COALESCE(better.id, tags.id) AS id,
            COALESCE(better.name, tags.name) AS name,
            COALESCE(better.subtag, tags.subtag) AS subtag,
            COALESCE(better.used, tags.used) AS used
          FROM tags
          LEFT JOIN tag_siblings ON tag_siblings.tagid = tags.id
          LEFT JOIN tags better ON tag_siblings.betterid = better.id
          WHERE tags.name LIKE ${i} OR tags.subtag LIKE ${i}
        )
    SELECT
      COALESCE(json_agg(json_build_object(
        'name', name,
        'posts', used,
        'siblings', siblings,
        'parents', parents
      )), '[]') AS tags,
      (SELECT count(1) FROM filtered)::INTEGER as total,
      ${a}::INTEGER as "pageSize"
    FROM (
      SELECT
        filtered.id,
        filtered.name,
        filtered.subtag,
        filtered.used,
        (
          SELECT COALESCE(json_agg(siblings.name), '[]')
          FROM tag_siblings
          LEFT JOIN tags siblings ON tagid = siblings.id
          WHERE betterid = filtered.id
        ) siblings,
        (
          SELECT COALESCE(json_agg(parents.name), '[]')
          FROM tag_parents
          LEFT JOIN tags parents ON parentid = parents.id
          WHERE tagid = filtered.id
        ) parents
      FROM filtered
      ORDER BY `.append(`filtered."${o}" ${s}, filtered.id ${s}`).append(l.default`
      LIMIT ${a}
      OFFSET ${n*a}
    ) x
  `));return r?p:Object.assign(Object.assign({},p),{tags:Object.fromEntries(p.tags.map((e=>[e.name,e.posts])))})}))}},6015:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(3685));class s extends Error{constructor(e,t=o.STATUS_CODES[e]){super(t),this.HTTPcode=e,this.publicMessage=t,Error.captureStackTrace(this,s)}}t.default=s},5946:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(7147)),l=o(n(5022)),u=n(6918);let c={port:3939,host:null,hydrusDbPath:null,appName:"HyBooru",appDescription:"Hydrus-based booru-styled imageboard in React",adminPassword:null,isTTY:null,importBatchSize:8192,db:{user:"hybooru",host:"localhost",database:"hybooru",password:"hybooru",port:5432},posts:{services:null,filesPathOverride:null,thumbnailsPathOverride:null,thumbnailsMode:u.ThumbnailsMode.FIT,pageSize:72,cachePages:5,cacheRecords:1024,maxPreviewSize:104857600},tags:{services:null,motd:null,untagged:"-*",ignore:[],blacklist:[],whitelist:null,resolveRelations:!0,reportLoops:!1,searchSummary:39},rating:{enabled:!0,stars:5,serviceName:null},versionCheck:{enabled:!0,owner:"funmaker",repo:"hybooru",cacheLifeMs:36e5}};function d(e){return"object"==typeof e&&null!==e&&e.constructor===Object&&"[object Object]"===Object.prototype.toString.call(e)}const f=["pageSize","cachePages","cacheRecords","filesPathOverride","thumbnailsPathOverride","maxPreviewSize"];try{c=function e(t,n){const a=Object.assign(Object.assign({},t),n);for(const r in n)n.hasOwnProperty(r)&&d(t[r])&&d(n[r])&&(a[r]=e(t[r],n[r]));return a}(c,JSON.parse(s.readFileSync("./configs.json").toString("utf-8")));for(const e of f)void 0!==c[e]&&(console.error(`${l.default.bold.yellow("Warning!")} Config option ${e} is deprecated and will be removed in future releases, use posts.${e} instead!`),c.posts[e]=c[e])}catch(e){throw console.error("Failed to read configs.json"),console.error(e),e}process.env.HYDRUS_ADMIN_PASSWORD&&(c.adminPassword=process.env.HYDRUS_ADMIN_PASSWORD),c.posts.thumbnailsMode!==u.ThumbnailsMode.FIT&&c.posts.thumbnailsMode!==u.ThumbnailsMode.FILL&&(console.error(`${l.default.bold.yellow("Warning!")} Config option posts.thumbnailsMode should be "fit" or "fill", got ${JSON.stringify(c.posts.thumbnailsMode)}!`),c.posts.thumbnailsMode="fit"),t.default=c},2854:(e,t)=>{"use strict";var n,a,r;function i(e){const n=e.match(t.namespaceRegex);return n?n[2].replace(t.underscoreRegex," "):e.replace(t.underscoreRegex," ")}Object.defineProperty(t,"__esModule",{value:!0}),t.postTitle=t.prettifyTag=t.thumbnailUrl=t.fileUrl=t.anyRatingRegex=t.rangeRatingRegex=t.underscoreRegex=t.namespaceRegex=t.MIME_STRING=t.MIME_EXT=t.Mime=t.ContentStatus=t.ServiceID=void 0,(r=t.ServiceID||(t.ServiceID={}))[r.TAG_REPOSITORY=0]="TAG_REPOSITORY",r[r.FILE_REPOSITORY=1]="FILE_REPOSITORY",r[r.LOCAL_FILE_DOMAIN=2]="LOCAL_FILE_DOMAIN",r[r.MESSAGE_DEPOT=3]="MESSAGE_DEPOT",r[r.LOCAL_TAG=5]="LOCAL_TAG",r[r.LOCAL_RATING_NUMERICAL=6]="LOCAL_RATING_NUMERICAL",r[r.LOCAL_RATING_LIKE=7]="LOCAL_RATING_LIKE",r[r.RATING_NUMERICAL_REPOSITORY=8]="RATING_NUMERICAL_REPOSITORY",r[r.RATING_LIKE_REPOSITORY=9]="RATING_LIKE_REPOSITORY",r[r.COMBINED_TAG=10]="COMBINED_TAG",r[r.COMBINED_FILE=11]="COMBINED_FILE",r[r.LOCAL_BOORU=12]="LOCAL_BOORU",r[r.IPFS=13]="IPFS",r[r.LOCAL_FILE_TRASH_DOMAIN=14]="LOCAL_FILE_TRASH_DOMAIN",r[r.COMBINED_LOCAL_FILE=15]="COMBINED_LOCAL_FILE",r[r.TEST_SERVICE=16]="TEST_SERVICE",r[r.LOCAL_NOTES=17]="LOCAL_NOTES",r[r.CLIENT_API_SERVICE=18]="CLIENT_API_SERVICE",r[r.COMBINED_DELETED_FILE=19]="COMBINED_DELETED_FILE",r[r.LOCAL_FILE_UPDATE_DOMAIN=20]="LOCAL_FILE_UPDATE_DOMAIN",r[r.COMBINED_LOCAL_MEDIA=21]="COMBINED_LOCAL_MEDIA",r[r.LOCAL_RATING_INCDEC=22]="LOCAL_RATING_INCDEC",r[r.SERVER_ADMIN=99]="SERVER_ADMIN",r[r.NULL_SERVICE=100]="NULL_SERVICE",(a=t.ContentStatus||(t.ContentStatus={}))[a.CURRENT=0]="CURRENT",a[a.PENDING=1]="PENDING",a[a.DELETED=2]="DELETED",a[a.PETITIONED=3]="PETITIONED",function(e){e[e.APPLICATION_HYDRUS_CLIENT_COLLECTION=0]="APPLICATION_HYDRUS_CLIENT_COLLECTION",e[e.IMAGE_JPEG=1]="IMAGE_JPEG",e[e.IMAGE_PNG=2]="IMAGE_PNG",e[e.ANIMATION_GIF=3]="ANIMATION_GIF",e[e.IMAGE_BMP=4]="IMAGE_BMP",e[e.APPLICATION_FLASH=5]="APPLICATION_FLASH",e[e.APPLICATION_YAML=6]="APPLICATION_YAML",e[e.IMAGE_ICON=7]="IMAGE_ICON",e[e.TEXT_HTML=8]="TEXT_HTML",e[e.VIDEO_FLV=9]="VIDEO_FLV",e[e.APPLICATION_PDF=10]="APPLICATION_PDF",e[e.APPLICATION_ZIP=11]="APPLICATION_ZIP",e[e.APPLICATION_HYDRUS_ENCRYPTED_ZIP=12]="APPLICATION_HYDRUS_ENCRYPTED_ZIP",e[e.AUDIO_MP3=13]="AUDIO_MP3",e[e.VIDEO_MP4=14]="VIDEO_MP4",e[e.AUDIO_OGG=15]="AUDIO_OGG",e[e.AUDIO_FLAC=16]="AUDIO_FLAC",e[e.AUDIO_WMA=17]="AUDIO_WMA",e[e.VIDEO_WMV=18]="VIDEO_WMV",e[e.UNDETERMINED_WM=19]="UNDETERMINED_WM",e[e.VIDEO_MKV=20]="VIDEO_MKV",e[e.VIDEO_WEBM=21]="VIDEO_WEBM",e[e.APPLICATION_JSON=22]="APPLICATION_JSON",e[e.ANIMATION_APNG=23]="ANIMATION_APNG",e[e.UNDETERMINED_PNG=24]="UNDETERMINED_PNG",e[e.VIDEO_MPEG=25]="VIDEO_MPEG",e[e.VIDEO_MOV=26]="VIDEO_MOV",e[e.VIDEO_AVI=27]="VIDEO_AVI",e[e.APPLICATION_HYDRUS_UPDATE_DEFINITIONS=28]="APPLICATION_HYDRUS_UPDATE_DEFINITIONS",e[e.APPLICATION_HYDRUS_UPDATE_CONTENT=29]="APPLICATION_HYDRUS_UPDATE_CONTENT",e[e.TEXT_PLAIN=30]="TEXT_PLAIN",e[e.APPLICATION_RAR=31]="APPLICATION_RAR",e[e.APPLICATION_7Z=32]="APPLICATION_7Z",e[e.IMAGE_WEBP=33]="IMAGE_WEBP",e[e.IMAGE_TIFF=34]="IMAGE_TIFF",e[e.APPLICATION_PSD=35]="APPLICATION_PSD",e[e.AUDIO_M4A=36]="AUDIO_M4A",e[e.VIDEO_REALMEDIA=37]="VIDEO_REALMEDIA",e[e.AUDIO_REALMEDIA=38]="AUDIO_REALMEDIA",e[e.AUDIO_TRUEAUDIO=39]="AUDIO_TRUEAUDIO",e[e.GENERAL_AUDIO=40]="GENERAL_AUDIO",e[e.GENERAL_IMAGE=41]="GENERAL_IMAGE",e[e.GENERAL_VIDEO=42]="GENERAL_VIDEO",e[e.GENERAL_APPLICATION=43]="GENERAL_APPLICATION",e[e.GENERAL_ANIMATION=44]="GENERAL_ANIMATION",e[e.APPLICATION_CLIP=45]="APPLICATION_CLIP",e[e.AUDIO_WAVE=46]="AUDIO_WAVE",e[e.VIDEO_OGV=47]="VIDEO_OGV",e[e.AUDIO_MKV=48]="AUDIO_MKV",e[e.AUDIO_MP4=49]="AUDIO_MP4",e[e.UNDETERMINED_MP4=50]="UNDETERMINED_MP4",e[e.APPLICATION_CBOR=51]="APPLICATION_CBOR",e[e.APPLICATION_WINDOWS_EXE=52]="APPLICATION_WINDOWS_EXE",e[e.AUDIO_WAVPACK=53]="AUDIO_WAVPACK",e[e.APPLICATION_SAI2=54]="APPLICATION_SAI2",e[e.APPLICATION_KRITA=55]="APPLICATION_KRITA",e[e.IMAGE_SVG=56]="IMAGE_SVG",e[e.APPLICATION_XCF=57]="APPLICATION_XCF",e[e.APPLICATION_GZIP=58]="APPLICATION_GZIP",e[e.GENERAL_APPLICATION_ARCHIVE=59]="GENERAL_APPLICATION_ARCHIVE",e[e.GENERAL_IMAGE_PROJECT=60]="GENERAL_IMAGE_PROJECT",e[e.IMAGE_HEIF=61]="IMAGE_HEIF",e[e.IMAGE_HEIF_SEQUENCE=62]="IMAGE_HEIF_SEQUENCE",e[e.IMAGE_HEIC=63]="IMAGE_HEIC",e[e.IMAGE_HEIC_SEQUENCE=64]="IMAGE_HEIC_SEQUENCE",e[e.IMAGE_AVIF=65]="IMAGE_AVIF",e[e.IMAGE_AVIF_SEQUENCE=66]="IMAGE_AVIF_SEQUENCE",e[e.UNDETERMINED_GIF=67]="UNDETERMINED_GIF",e[e.IMAGE_GIF=68]="IMAGE_GIF",e[e.APPLICATION_PROCREATE=69]="APPLICATION_PROCREATE",e[e.IMAGE_QOI=70]="IMAGE_QOI",e[e.APPLICATION_OCTET_STREAM=100]="APPLICATION_OCTET_STREAM",e[e.APPLICATION_UNKNOWN=101]="APPLICATION_UNKNOWN"}(n=t.Mime||(t.Mime={})),t.MIME_EXT={[n.APPLICATION_HYDRUS_CLIENT_COLLECTION]:".collection",[n.IMAGE_JPEG]:".jpg",[n.IMAGE_PNG]:".png",[n.ANIMATION_APNG]:".png",[n.IMAGE_GIF]:".gif",[n.ANIMATION_GIF]:".gif",[n.IMAGE_BMP]:".bmp",[n.IMAGE_WEBP]:".webp",[n.IMAGE_TIFF]:".tiff",[n.IMAGE_QOI]:".qoi",[n.IMAGE_ICON]:".ico",[n.IMAGE_SVG]:".svg",[n.IMAGE_HEIF]:".heif",[n.IMAGE_HEIF_SEQUENCE]:".heifs",[n.IMAGE_HEIC]:".heic",[n.IMAGE_HEIC_SEQUENCE]:".heics",[n.IMAGE_AVIF]:".avif",[n.IMAGE_AVIF_SEQUENCE]:".avifs",[n.APPLICATION_FLASH]:".swf",[n.APPLICATION_OCTET_STREAM]:".bin",[n.APPLICATION_YAML]:".yaml",[n.APPLICATION_JSON]:".json",[n.APPLICATION_PDF]:".pdf",[n.APPLICATION_PSD]:".psd",[n.APPLICATION_CLIP]:".clip",[n.APPLICATION_SAI2]:".sai2",[n.APPLICATION_KRITA]:".kra",[n.APPLICATION_XCF]:".xcf",[n.APPLICATION_PROCREATE]:".procreate",[n.APPLICATION_ZIP]:".zip",[n.APPLICATION_RAR]:".rar",[n.APPLICATION_7Z]:".7z",[n.APPLICATION_GZIP]:".gz",[n.APPLICATION_WINDOWS_EXE]:".exe",[n.APPLICATION_HYDRUS_ENCRYPTED_ZIP]:".zip.encrypted",[n.APPLICATION_HYDRUS_UPDATE_CONTENT]:"",[n.APPLICATION_HYDRUS_UPDATE_DEFINITIONS]:"",[n.AUDIO_M4A]:".m4a",[n.AUDIO_MP3]:".mp3",[n.AUDIO_MKV]:".mkv",[n.AUDIO_MP4]:".mp4",[n.AUDIO_OGG]:".ogg",[n.AUDIO_REALMEDIA]:".ra",[n.AUDIO_FLAC]:".flac",[n.AUDIO_WAVE]:".wav",[n.AUDIO_TRUEAUDIO]:".tta",[n.AUDIO_WMA]:".wma",[n.AUDIO_WAVPACK]:".wv",[n.TEXT_HTML]:".html",[n.TEXT_PLAIN]:".txt",[n.VIDEO_AVI]:".avi",[n.VIDEO_FLV]:".flv",[n.VIDEO_MOV]:".mov",[n.VIDEO_MP4]:".mp4",[n.VIDEO_MPEG]:".mpeg",[n.VIDEO_WMV]:".wmv",[n.VIDEO_MKV]:".mkv",[n.VIDEO_OGV]:".ogv",[n.VIDEO_REALMEDIA]:".rm",[n.VIDEO_WEBM]:".webm",[n.APPLICATION_UNKNOWN]:""},t.MIME_STRING={[n.APPLICATION_HYDRUS_CLIENT_COLLECTION]:"collection",[n.IMAGE_JPEG]:"image/jpeg",[n.IMAGE_PNG]:"image/png",[n.ANIMATION_APNG]:"image/apng",[n.IMAGE_GIF]:"image/gif",[n.ANIMATION_GIF]:"image/gif",[n.IMAGE_BMP]:"image/bmp",[n.IMAGE_WEBP]:"image/webp",[n.IMAGE_TIFF]:"image/tiff",[n.IMAGE_QOI]:"image/qoi",[n.IMAGE_ICON]:"image/x-icon",[n.IMAGE_SVG]:"image/svg+xml",[n.IMAGE_HEIF]:"image/heif",[n.IMAGE_HEIF_SEQUENCE]:"image/heif-sequence",[n.IMAGE_HEIC]:"image/heic",[n.IMAGE_HEIC_SEQUENCE]:"image/heic-sequence",[n.IMAGE_AVIF]:"image/avif",[n.IMAGE_AVIF_SEQUENCE]:"image/avif-sequence",[n.APPLICATION_FLASH]:"application/x-shockwave-flash",[n.APPLICATION_OCTET_STREAM]:"application/octet-stream",[n.APPLICATION_YAML]:"application/x-yaml",[n.APPLICATION_JSON]:"application/json",[n.APPLICATION_CBOR]:"application/cbor",[n.APPLICATION_PDF]:"application/pdf",[n.APPLICATION_PSD]:"image/vnd.adobe.photoshop",[n.APPLICATION_CLIP]:"application/clip",[n.APPLICATION_SAI2]:"application/sai2",[n.APPLICATION_KRITA]:"application/x-krita",[n.APPLICATION_XCF]:"image/x-xcf",[n.APPLICATION_PROCREATE]:"application/x-procreate",[n.APPLICATION_ZIP]:"application/zip",[n.APPLICATION_RAR]:"application/vnd.rar",[n.APPLICATION_7Z]:"application/x-7z-compressed",[n.APPLICATION_GZIP]:"application/gzip",[n.APPLICATION_WINDOWS_EXE]:"application/octet-stream",[n.APPLICATION_HYDRUS_ENCRYPTED_ZIP]:"application/hydrus-encrypted-zip",[n.APPLICATION_HYDRUS_UPDATE_CONTENT]:"application/hydrus-update-content",[n.APPLICATION_HYDRUS_UPDATE_DEFINITIONS]:"application/hydrus-update-definitions",[n.AUDIO_M4A]:"audio/mp4",[n.AUDIO_MP3]:"audio/mp3",[n.AUDIO_OGG]:"audio/ogg",[n.AUDIO_FLAC]:"audio/flac",[n.AUDIO_MKV]:"audio/x-matroska",[n.AUDIO_MP4]:"audio/mp4",[n.AUDIO_WAVE]:"audio/x-wav",[n.AUDIO_REALMEDIA]:"audio/vnd.rn-realaudio",[n.AUDIO_TRUEAUDIO]:"audio/x-tta",[n.AUDIO_WMA]:"audio/x-ms-wma",[n.AUDIO_WAVPACK]:"audio/wavpack",[n.TEXT_HTML]:"text/html",[n.TEXT_PLAIN]:"text/plain",[n.VIDEO_AVI]:"video/x-msvideo",[n.VIDEO_FLV]:"video/x-flv",[n.VIDEO_MOV]:"video/quicktime",[n.VIDEO_MP4]:"video/mp4",[n.VIDEO_MPEG]:"video/mpeg",[n.VIDEO_WMV]:"video/x-ms-wmv",[n.VIDEO_MKV]:"video/x-matroska",[n.VIDEO_OGV]:"video/ogg",[n.VIDEO_REALMEDIA]:"video/vnd.rn-realvideo",[n.VIDEO_WEBM]:"video/webm",[n.APPLICATION_UNKNOWN]:"unknown filetype",[n.GENERAL_APPLICATION]:"application",[n.GENERAL_APPLICATION_ARCHIVE]:"archive",[n.GENERAL_IMAGE_PROJECT]:"image project file",[n.GENERAL_AUDIO]:"audio",[n.GENERAL_IMAGE]:"image",[n.GENERAL_VIDEO]:"video",[n.GENERAL_ANIMATION]:"animation"},t.namespaceRegex=/(.+?):(.+)/,t.underscoreRegex=/_/g,t.rangeRatingRegex=/^rating:(\d+)(?:-(\d+))?$/,t.anyRatingRegex=/^rating:(\d+(?:-\d+)?|none)$/,t.fileUrl=e=>`/files/f${e.sha256}${e.extension}`,t.thumbnailUrl=e=>`/files/t${e.sha256}.thumbnail`,t.prettifyTag=i;const o=e=>e.toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ");t.postTitle=function(e){const t=Object.keys(e.tags),n=t.filter((e=>e.startsWith("title:"))).map(i).join(" - "),a=t.filter((e=>e.startsWith("creator:"))).map(i).join(" & "),r=t.filter((e=>e.startsWith("character:"))).map(i).join(", ");let s="";return s+=n?o(n):r?o(r):`Post ${e.id}`,a&&(s+=` by ${o(a)}`),s}},2614:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initialize=t.findHydrusDB=t.isInitialized=t.queryFirst=t.queryAll=t.query=t.pool=void 0;const l=i(n(5900)),u=s(n(2419)),c=s(n(5022)),d=s(n(5946)),f=i(n(4126));l.default.types.setTypeParser(20,Number),t.pool=new l.Pool(d.default.db);let p=null;function h(e,n=t.pool){return o(this,void 0,void 0,(function*(){n===t.pool&&(yield p);const{rows:a}=yield n.query(e);return a[0]||null}))}function E(){return o(this,void 0,void 0,(function*(){if(!(yield h(u.default`
    SELECT 1
    FROM information_schema.tables
    WHERE table_schema = 'public'
    AND table_name = 'meta'
  `)))return!1;const{hash:e}=yield h(u.default`SELECT hash FROM meta`);return e===f.setupHash}))}function m(){return o(this,void 0,void 0,(function*(){if(p)return yield p;p=f.rebuild(),yield p,p=null}))}t.query=function(e,n=t.pool){return o(this,void 0,void 0,(function*(){return n===t.pool&&(yield p),n.query(e)}))},t.queryAll=function(e,n=t.pool){return o(this,void 0,void 0,(function*(){n===t.pool&&(yield p);const{rows:a}=yield n.query(e);return a}))},t.queryFirst=h,t.isInitialized=E,t.findHydrusDB=function(){let e=d.default.hydrusDbPath;if(!e){const t=e=process.env.APPDATA||("darwin"==process.platform?process.env.HOME+"/Library/Preferences":process.env.HOME+"/.local/share");e=`${t}/hydrus/db`}return e},t.initialize=m,o(void 0,void 0,void 0,(function*(){(yield E())||(console.log(c.default.bold.yellow("Database update detected, rebuilding...")),yield m())})).catch((e=>{console.error("Unable to initialize DB!"),console.error(e),process.exit(1)}))},6018:function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Import=void 0;const i=r(n(9719)),o=r(n(5946)),s=n(6971);t.Import=class{constructor(e,t){this.hydrus=e,this.postgres=t,this.batchSizeMul=1,this.initialKey=[-1],this.useTemp=!1,this.totalCount=null}total(){return null===this.totalCount&&(this.totalCount=this.hydrus.prepare(this.totalQuery()).raw().get()[0]),this.totalCount}resetTotal(e=null){this.totalCount=e}importBatch(e,t,n,r){return a(this,void 0,void 0,(function*(){const a=n.all(...e,t);let i="";for(const e of a)i+=e.pop();return r.write(i),a.length>0?a[a.length-1]:null}))}start(){return a(this,void 0,void 0,(function*(){(0,s.printProgress)(!1,this.display);const e=Math.ceil(o.default.importBatchSize*this.batchSizeMul),t=this.total();let n=0;if(0===t)return void(0,s.printProgress)(!0,this.display);(0,s.printProgress)([0,t],this.display);const a=yield this.beforeImport(),r=this.hydrus.prepare(this.inputQuery()).raw(!0),l=yield this.postgres.query(i.default.from(this.outputQuery(a)));let u=this.initialKey;for(;;){const a=yield this.importBatch(u,e,r,l);if(!a)break;u=a,n+=e,l.writableLength>l.writableHighWaterMark?((0,s.printProgress)([n,t],this.display),yield new Promise((e=>l.once("drain",e)))):yield new Promise((e=>setImmediate(e)))}yield new Promise((e=>l.end(e))),yield this.afterImport(),(0,s.printProgress)([t,t],this.display)}))}beforeImport(){return a(this,void 0,void 0,(function*(){return this.useTemp?(yield this.postgres.query(`\n        CREATE TEMP TABLE ${this.outputTable}_temp (LIKE ${this.outputTable});\n      `),`${this.outputTable}_temp`):this.outputTable}))}afterImport(){return a(this,void 0,void 0,(function*(){this.useTemp&&(yield this.postgres.query(`\n        INSERT INTO ${this.outputTable} SELECT * FROM ${this.outputTable}_temp ON CONFLICT DO NOTHING;\n        DROP TABLE ${this.outputTable}_temp;\n      `))}))}}},4126:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.rebuild=t.setupHash=void 0;const l=s(n(1017)),u=s(n(5022)),c=s(n(5890)),d=s(n(9066)),f=s(n(2419)),p=i(n(7430)),h=n(6918),E=n(5718),m=n(2614),g=n(2854),_=s(n(5946)),O=n(6971),I=s(n(6222)),v=s(n(9096)),b=s(n(807)),A=s(n(8393)),y=s(n(1384)),T=s(n(5197)),N=s(n(6573)),P=s(n(7226)),R=s(n(4291));t.setupHash=function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(v.default+I.default),t.rebuild=function(){return o(this,void 0,void 0,(function*(){console.log(u.default.cyan.bold("\nRebuilding Database!\n"));const e=Date.now(),n=yield m.pool.connect();yield n.query("BEGIN");try{yield n.query(v.default),p.clearCache();const a=(0,m.findHydrusDB)(),r=_.default.tags.resolveRelations,i=new c.default(l.default.resolve(a,"client.db"),{readonly:!0});yield i.exec(`ATTACH '${l.default.resolve(a,"client.mappings.db")}' AS mappings`),yield i.exec(`ATTACH '${l.default.resolve(a,"client.master.db")}' AS master`);const{version:s}=i.prepare("SELECT version FROM version;").get();if(s<559)throw new Error(`Unsupported Hydrus version(min: v559, current: v${s}), Update Hydrus to the newest version.`);const M=function(e){let t=e.prepare(`\n    SELECT\n      service_id AS id,\n      name,\n      service_type = ${g.ServiceID.LOCAL_FILE_TRASH_DOMAIN} AS trash\n    FROM services\n    WHERE service_type = ${g.ServiceID.LOCAL_FILE_DOMAIN}\n       OR service_type = ${g.ServiceID.FILE_REPOSITORY}\n       OR service_type = ${g.ServiceID.LOCAL_FILE_TRASH_DOMAIN}\n   `).all();if(0===t.length)throw new Error("Unable to locate any file services!");if(_.default.posts.services){for(const e of _.default.posts.services)if("string"==typeof e){if(t.every((t=>t.name!==e)))throw new Error(`Unable to locate file service with name '${e}'`)}else if(t.every((t=>t.id!==e)))throw new Error(`Unable to locate file service with id '${e}'`);t=t.filter((e=>{var t,n;return(null===(t=_.default.posts.services)||void 0===t?void 0:t.includes(e.name))||(null===(n=_.default.posts.services)||void 0===n?void 0:n.includes(e.id))}))}return t}(i),L=function(e){if(_.default.rating&&_.default.rating.enabled){if(null!==_.default.rating.serviceName){const t=e.prepare("SELECT service_id AS id, service_type AS type FROM services WHERE name = ?").get(_.default.rating.serviceName);if(t){if(t.type!==g.ServiceID.LOCAL_RATING_NUMERICAL)throw new Error(`Service ${_.default.rating.serviceName} is not a numerical rating service!`);return t.id}throw new Error(`There is no rating service ${_.default.rating.serviceName}!`)}{const t=e.prepare("SELECT service_id AS id FROM services WHERE service_type = ?").get(g.ServiceID.LOCAL_RATING_NUMERICAL);if(t)return t.id;console.error(u.default.yellow("Unable to locate any numerical rating service! Rating disabled.")),_.default.rating=null}}return null}(i),C=function(e){let t=e.prepare(`SELECT service_id AS id, name FROM services WHERE service_type = ${g.ServiceID.LOCAL_TAG} OR service_type = ${g.ServiceID.TAG_REPOSITORY}`).all();if(0===t.length)throw new Error("Unable to locate any tag services!");if(_.default.tags.services){for(const e of _.default.tags.services)if("string"==typeof e){if(t.every((t=>t.name!==e)))throw new Error(`Unable to locate tag service with name '${e}'`)}else if(t.every((t=>t.id!==e)))throw new Error(`Unable to locate tag service with id '${e}'`);t=t.filter((e=>{var t,n;return(null===(t=_.default.tags.services)||void 0===t?void 0:t.includes(e.name))||(null===(n=_.default.tags.services)||void 0===n?void 0:n.includes(e.id))}))}return t.map((e=>e.id))}(i);yield new b.default(i,n,L).startEach(M),yield new T.default(i,n).start(),yield new N.default(i,n).start(),yield new A.default(i,n).start(),yield new y.default(i,n).startEach(C),r&&(yield new P.default(i,n,C).start()),r&&(yield new R.default(i,n,C).start());const S=yield function(e,t){return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Importing options... ");let{options:n}=e.prepare("SELECT options FROM options").get();global.YAML_SILENCE_WARNINGS=!0,n=d.default.parse(n),global.YAML_SILENCE_WARNINGS=!1;const a=n.namespace_colours,r=Object.entries(a).map((([e,t],n)=>({id:n,name:e,color:"#"+(256*t[0]*256+256*t[1]+t[2]).toString(16).padStart(6,"0")})));return yield t.query(f.default`
    INSERT INTO namespaces(id, name, color)
    SELECT id, name, color
    FROM json_to_recordset(${JSON.stringify(r)})
      AS x(
        id INTEGER,
        name TEXT,
        color TEXT
      )
  `),(0,O.printProgress)(!0,"Importing options... "),n}))}(i,n);yield function(e,t){var n;return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Resolving file relations...");const a=e.prepare('\n    SELECT\n      duplicate_files.media_id AS "mediaId", duplicate_files.king_hash_id AS "bestPostId",\n      group_concat(duplicate_file_members.hash_id) AS duplicates,\n      (\n        SELECT group_concat(alts.hash_id)\n        FROM duplicate_file_members alts\n        INNER JOIN alternate_file_group_members afgm1 ON afgm1.media_id = alts.media_id\n        INNER JOIN alternate_file_group_members afgm2 ON afgm2.alternates_group_id = afgm1.alternates_group_id AND afgm1.media_id != afgm2.media_id\n        WHERE afgm2.media_id = duplicate_files.media_id\n      ) AS alternatives\n    FROM duplicate_files\n    LEFT JOIN duplicate_file_members ON duplicate_files.media_id == duplicate_file_members.media_id\n    GROUP BY duplicate_files.media_id\n    HAVING count(1) > 1 OR alternatives IS NOT NULL\n  ').all(),r=[];for(const e of a){if(!e.duplicates)continue;const t=e.duplicates.split(",").map((e=>parseInt(e))),a=(null===(n=e.alternatives)||void 0===n?void 0:n.split(",").map((e=>parseInt(e))))||[];for(const n of t){for(const a of t)n!==a&&r.push({post:n,other:a,kind:a===e.bestPostId?h.Relation.DUPLICATE_BEST:h.Relation.DUPLICATE});for(const e of a)r.push({post:n,other:e,kind:h.Relation.ALTERNATE})}}yield t.query(f.default`
    INSERT INTO relations(postid, other_postid, kind)
    SELECT (relation->>'post')::INTEGER, (relation->>'other')::INTEGER, relation->>'kind'
    FROM unnest(${r}::JSON[]) relation
  `),(0,O.printProgress)(!0,"Resolving file relations...")}))}(i,n),r&&(yield function(e){return o(this,void 0,void 0,(function*(){(0,O.printProgress)([0,6],"Normalizing tags");const t=yield e.query(f.default`
    WITH RECURSIVE paths(tagid, visited) AS (
        SELECT DISTINCT tag_siblings.betterid, ARRAY[tag_siblings.tagid]
        FROM tag_siblings
      UNION ALL
        SELECT tag_siblings.betterid, paths.visited || paths.tagid
        FROM paths
        INNER JOIN tag_siblings ON tag_siblings.tagid = paths.tagid
        WHERE paths.tagid != ALL(paths.visited)
    ), loops(tagid, path) AS (
      SELECT tagid, visited || tagid
      FROM paths
      WHERE tagid = visited[1] AND tagid <= ALL(visited)
      ORDER BY tagid
    )
    DELETE FROM tag_siblings
    USING loops
    WHERE tag_siblings.tagid = loops.tagid AND tag_siblings.betterid = loops.path[2]
    RETURNING path
  `);(0,O.printProgress)([1,6],"Normalizing tags"),yield e.query(f.default`
    WITH RECURSIVE roots(tagid, rootid) AS (
        SELECT DISTINCT betterid, betterid
        FROM tag_siblings
        WHERE NOT EXISTS(SELECT 1 FROM tag_siblings ts2 WHERE ts2.tagid = tag_siblings.betterid)
      UNION ALL
        SELECT DISTINCT tag_siblings.tagid, roots.rootid
        FROM roots
        INNER JOIN tag_siblings ON tag_siblings.betterid = roots.tagid
    ),
    bad_siblings AS (
      DELETE FROM tag_siblings
      USING roots
      WHERE tag_siblings.tagid = roots.tagid
        AND tag_siblings.betterid != roots.rootid
      RETURNING tag_siblings.tagid, roots.rootid
    )
    INSERT INTO tag_siblings(tagid, betterid)
    TABLE bad_siblings
    ON CONFLICT DO NOTHING
  `),(0,O.printProgress)([2,6],"Normalizing tags"),yield e.query(f.default`
    WITH bad_parents AS (
      DELETE FROM tag_parents
      USING tag_siblings
      WHERE tag_siblings.tagid = tag_parents.tagid
      RETURNING tag_siblings.betterid, tag_parents.parentid
    )
    INSERT INTO tag_parents(tagid, parentid)
    TABLE bad_parents
    ON CONFLICT DO NOTHING
  `),(0,O.printProgress)([3,6],"Normalizing tags"),yield e.query(f.default`
    WITH bad_parents AS (
      DELETE FROM tag_parents
      USING tag_siblings
      WHERE tag_siblings.tagid = tag_parents.parentid
      RETURNING tag_parents.tagid, tag_siblings.betterid
    )
    INSERT INTO tag_parents(tagid, parentid)
    TABLE bad_parents
    ON CONFLICT DO NOTHING
  `),(0,O.printProgress)([4,6],"Normalizing tags"),yield e.query(f.default`
    WITH bad_maps AS (
      DELETE FROM mappings
      USING tag_siblings
      WHERE tag_siblings.tagid = mappings.tagid
      RETURNING mappings.postid, tag_siblings.betterid
    )
    INSERT INTO mappings(postid, tagid)
    SELECT postid, betterid FROM bad_maps
    ON CONFLICT DO NOTHING
  `),(0,O.printProgress)([5,6],"Normalizing tags");const n=yield e.query(f.default`
    WITH RECURSIVE paths(tagid, visited) AS (
        SELECT DISTINCT tag_parents.parentid, ARRAY[tag_parents.tagid]
        FROM tag_parents
      UNION ALL
        SELECT tag_parents.parentid, paths.visited || paths.tagid
        FROM paths
        INNER JOIN tag_parents ON tag_parents.tagid = paths.tagid
        WHERE paths.tagid != ALL(paths.visited)
    ), loops(tagid, path) AS (
      SELECT tagid, visited || tagid
      FROM paths
      WHERE tagid = visited[1] AND tagid <= ALL(visited)
      ORDER BY tagid
    )
    DELETE FROM tag_parents
    USING loops
    WHERE tag_parents.tagid = loops.tagid AND tag_parents.parentid = loops.path[2]
    RETURNING path
  `);if((0,O.printProgress)([6,6],"Normalizing tags"),t.rows.length>0&&(console.error(`${u.default.bold.yellow("Warning!")} Detected ${t.rows.length} loops in tag siblings!`),_.default.tags.reportLoops)){console.error();const n=yield e.query(f.default`
        SELECT string_agg(COALESCE(tags.name, 'null'), ' <- ' ORDER BY path_el.id) AS path
        FROM jsonb_array_elements(${JSON.stringify(t.rows.map((e=>e.path)))}) WITH ORDINALITY paths(path, pathid),
             jsonb_array_elements(paths.path) WITH ORDINALITY path_el(tagid, id)
        LEFT JOIN tags ON tags.id = path_el.tagid::INTEGER
        GROUP BY paths.pathid
      `);for(const e of n.rows)console.error(u.default.gray(e.path));console.error(u.default.bold("\nLast relation of these chains has been ignored.\n"))}if(n.rows.length>0&&(console.error(`${u.default.bold.yellow("Warning!")} Detected ${n.rows.length} loops in tag parents!`),_.default.tags.reportLoops)){console.error();const t=yield e.query(f.default`
        SELECT string_agg(COALESCE(tags.name, 'null'), ' <- ' ORDER BY path_el.id) AS path
        FROM jsonb_array_elements(${JSON.stringify(n.rows.map((e=>e.path)))}) WITH ORDINALITY paths(path, pathid),
             jsonb_array_elements(paths.path) WITH ORDINALITY path_el(tagid, id)
        LEFT JOIN tags ON tags.id = path_el.tagid::INTEGER
        GROUP BY paths.pathid
      `);for(const e of t.rows)console.error(u.default.gray(e.path));console.error(u.default.bold("\nLast relation of these chains has been ignored.\n"))}}))}(n)),_.default.tags.blacklist&&_.default.tags.blacklist.length>0&&(yield function(e){var t;return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Applying blacklist...");const n=(null===(t=_.default.tags.blacklist)||void 0===t?void 0:t.map((e=>(0,E.preparePattern)(e))))||[],a=n.filter((e=>!e.startsWith("system:"))),r=n.filter((e=>e.startsWith("system:")));a.length>0&&(yield e.query(f.default`
      DELETE FROM posts
      USING unnest(${a}::TEXT[]) pat
      INNER JOIN tags ON tags.name LIKE pat OR tags.subtag LIKE pat
      INNER JOIN mappings ON mappings.tagid = tags.id
      WHERE mappings.postid = posts.id
    `));const i=[];r.includes("system:inbox")&&i.push(f.default`posts.inbox`),r.includes("system:archive")&&i.push(f.default`NOT posts.inbox`),r.includes("system:trash")&&i.push(f.default`posts.trash`);const o=i.reduce(((e,t)=>(e?e.append(" OR "):f.default`WHERE `).append(t)),null);o&&(yield e.query(f.default`
    DELETE FROM posts
    `.append(o))),(0,O.printProgress)(!0,"Applying blacklist...")}))}(n)),_.default.tags.whitelist&&_.default.tags.whitelist.length>0&&(yield function(e){var t;return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Applying whitelist...");const n=(null===(t=_.default.tags.whitelist)||void 0===t?void 0:t.map((e=>(0,E.preparePattern)(e))))||[],a=n.filter((e=>!e.startsWith("system:"))),r=n.filter((e=>e.startsWith("system:")));a.length>0&&(yield e.query(f.default`
      DELETE FROM posts
      WHERE NOT EXISTS(
        SELECT 1
        FROM unnest(${a}::TEXT[]) pat
        INNER JOIN tags ON tags.name LIKE pat OR tags.subtag LIKE pat
        INNER JOIN mappings ON mappings.tagid = tags.id
        WHERE mappings.postid = posts.id
      )
    `));const i=[];r.includes("system:inbox")&&i.push(f.default`NOT posts.inbox`),r.includes("system:archive")&&i.push(f.default`posts.inbox`),r.includes("system:trash")&&i.push(f.default`NOT posts.trash`);const o=i.reduce(((e,t)=>(e?e.append(" OR "):f.default`WHERE `).append(t)),null);o&&(yield e.query(f.default`
    DELETE FROM posts
    `.append(o))),(0,O.printProgress)(!0,"Applying whitelist...")}))}(n)),_.default.tags.ignore.length>0&&(yield function(e){return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Removing ignored tags...");const t=_.default.tags.ignore.map((e=>(0,E.preparePattern)(e))),n=yield e.query(f.default`
    DELETE FROM tags
    USING unnest(${t}::TEXT[]) pat
    WHERE tags.name LIKE pat OR tags.subtag LIKE pat
    RETURNING id
  `);yield e.query(f.default`
    DELETE FROM tags
    USING unnest(${n.rows.map((e=>e.id))}::INTEGER[]) deleted
    LEFT JOIN tag_siblings ON tag_siblings.tagid = deleted
    WHERE tag_siblings.betterid = tags.id
  `),yield e.query(f.default`
    DELETE FROM tags
    USING unnest(${n.rows.map((e=>e.id))}::INTEGER[]) deleted
    LEFT JOIN tag_siblings ON tag_siblings.betterid = deleted
    WHERE tag_siblings.tagid = tags.id
  `),(0,O.printProgress)(!0,"Removing ignored tags...")}))}(n)),r&&(yield function(e){return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Resolving tag parents..."),yield e.query(f.default`
    WITH RECURSIVE ancestors(tagid, ancestorid) AS (
        SELECT tagid, parentid
        FROM tag_parents
      UNION ALL
        SELECT tag_parents.tagid, ancestors.ancestorid
        FROM ancestors
        INNER JOIN tag_parents ON tag_parents.parentid = ancestors.tagid
    )
    INSERT INTO mappings(postid, tagid)
    SELECT mappings.postid, ancestors.ancestorid
    FROM mappings
    INNER JOIN ancestors ON mappings.tagid = ancestors.tagid
    ON CONFLICT DO NOTHING
  `),(0,O.printProgress)(!0,"Resolving tag parents...")}))}(n)),yield function(e){return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Indexing");const t=I.default.split(";").map((e=>e.trim())).filter((e=>e));(0,O.printProgress)([0,t.length],"Indexing");let n=0;for(const a of t)yield e.query(a),n++,(0,O.printProgress)([n,t.length],"Indexing")}))}(n),r&&(yield function(e){return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Resolving tag siblings..."),yield e.query(f.default`
    INSERT INTO tag_postids
    SELECT tag_siblings.tagid, tag_postids.postids
    FROM tag_siblings
    INNER JOIN tag_postids ON tag_postids.tagid = tag_siblings.betterid
  `),(0,O.printProgress)(!0,"Resolving tag siblings...")}))}(n)),yield function(e){return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Counting tags usage..."),yield e.query(f.default`
    UPDATE tags
    SET used = icount(tag_postids.postids)
    FROM tag_postids
    WHERE tag_postids.tagid = tags.id
  `),(0,O.printProgress)(!0,"Counting tags usage...")}))}(n),yield function(e,t,n){var a;return o(this,void 0,void 0,(function*(){(0,O.printProgress)(!1,"Calculating statistics...");const r=yield p.search({query:_.default.tags.untagged},e);let i=(null===(a=_.default.rating)||void 0===a?void 0:a.stars)||null;null===n&&(i=null),yield e.query(f.default`
    INSERT INTO global(thumbnail_width, thumbnail_height, posts, tags, mappings, needs_tags, rating_stars)
    SELECT
      ${t.thumbnail_dimensions[0]} AS thumbnail_width,
      ${t.thumbnail_dimensions[1]} AS thumbnail_height,
      (SELECT COUNT(1) FROM posts) AS posts,
      (SELECT COUNT(1) FROM tags) AS tags,
      (SELECT COUNT(1) FROM mappings) AS mappings,
      ${r.total} AS needs_tags,
      ${i} AS rating_stars
  `),(0,O.printProgress)(!0,"Calculating statistics...")}))}(n,S,L),(0,O.printProgress)(!1,"Finalizing..."),i.close(),yield n.query(f.default`UPDATE meta SET hash = ${t.setupHash}`),yield n.query(f.default`COMMIT`),(0,O.printProgress)(!0,"Finalizing..."),console.log(`${u.default.bold.green("\nDatabase rebuild completed")} in ${(0,O.elapsed)(e)}\n`)}catch(e){throw yield n.query("ROLLBACK"),e}finally{n.release()}}))}},1384:function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6018);class i extends r.Import{constructor(){super(...arguments),this.display="Mappings",this.service=0,this.inputTable=()=>`current_mappings_${this.service}`,this.initialKey=[-1,-1],this.outputTable="mappings",this.totalQuery=()=>`SELECT count(1) FROM ${this.inputTable()}`,this.outputQuery=e=>`COPY ${e}(postid, tagid) FROM STDIN (FORMAT CSV)`,this.inputQuery=()=>`\n    SELECT\n      mappings.hash_id,\n      mappings.tag_id,\n      mappings.hash_id || ',' ||\n      mappings.tag_id || '\n'\n    FROM ${this.inputTable()} mappings\n    WHERE (mappings.hash_id, mappings.tag_id) > (?, ?)\n    ORDER BY mappings.hash_id, mappings.tag_id\n    LIMIT ?\n  `}startEach(e){return a(this,void 0,void 0,(function*(){const t=e.map((e=>(this.resetTotal(),this.service=e,{service:e,total:this.total()})));t.sort(((e,t)=>t.total-e.total));for(const{service:e,total:n}of t)0!==n&&(this.resetTotal(n),this.service=e,yield this.start(),this.useTemp=!0)}))}}t.default=i},6573:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(6018);class r extends a.Import{constructor(){super(...arguments),this.display="Notes",this.batchSizeMul=1/4,this.outputTable="notes",this.totalQuery=()=>"\n    SELECT count(1) FROM file_notes\n      INNER JOIN notes ON file_notes.note_id = notes.note_id\n      INNER JOIN labels ON file_notes.name_id = labels.label_id\n  ",this.outputQuery=e=>`COPY ${e}(id, postid, label, note) FROM STDIN (FORMAT CSV)`,this.inputQuery=()=>"\n    SELECT\n      file_notes.note_id,\n      file_notes.note_id || ',' ||\n      file_notes.hash_id || ',\"' ||\n      REPLACE(labels.label, '\"', '\"\"') || '\",\"' ||\n      REPLACE(notes.note, '\"', '\"\"') || '\"\n'\n    FROM file_notes\n      INNER JOIN notes ON file_notes.note_id = notes.note_id\n      INNER JOIN labels ON file_notes.name_id = labels.label_id\n    WHERE file_notes.note_id > ?\n    ORDER BY file_notes.note_id\n    LIMIT ?\n  "}}t.default=r},807:function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6018);class i extends r.Import{constructor(e,t,n){super(e,t),this.ratingService=n,this.display="Posts",this.inputTable=()=>{var e;return`current_files_${(null===(e=this.service)||void 0===e?void 0:e.id)||0}`},this.batchSizeMul=.5,this.outputTable="posts",this.totalQuery=()=>`SELECT count(1) FROM ${this.inputTable()}`,this.outputQuery=e=>`COPY ${e}(id, sha256, md5, blurhash, size, width, height, duration, num_frames, has_audio, rating, mime, inbox, trash, posted) FROM STDIN (FORMAT CSV)`,this.inputQuery=()=>{var e;return`\n    SELECT\n      current_files.hash_id,\n      current_files.hash_id || ',' ||\n      '\\x' || hex(hashes.hash) || ',' ||\n      COALESCE('\\x' || NULLIF(hex(local_hashes.md5), ''), '') || ',' ||\n      COALESCE('"' || blurhashes.blurhash || '"', '') || ',' ||\n      COALESCE(files_info.size, '') || ',' ||\n      COALESCE(files_info.width, '') || ',' ||\n      COALESCE(files_info.height, '') || ',' ||\n      COALESCE(files_info.duration, '') || ',' ||\n      COALESCE(files_info.num_frames, '') || ',' ||\n      COALESCE(files_info.has_audio, '') || ',' ||\n      COALESCE(local_ratings.rating, '') || ',' ||\n      COALESCE(files_info.mime, '') || ',' ||\n      (file_inbox.hash_id IS NOT NULL) || ',' ||\n      ${!!(null===(e=this.service)||void 0===e?void 0:e.trash)} || ',' ||\n      datetime(current_files.timestamp_ms / 1000, 'unixepoch', 'utc') || '\n'\n    FROM ${this.inputTable()} current_files\n      INNER JOIN hashes ON hashes.hash_id = current_files.hash_id\n      LEFT JOIN files_info ON files_info.hash_id = current_files.hash_id\n      LEFT JOIN local_hashes ON local_hashes.hash_id = current_files.hash_id\n      LEFT JOIN blurhashes ON blurhashes.hash_id = current_files.hash_id\n      LEFT JOIN local_ratings ON local_ratings.service_id = ${this.ratingService} AND local_ratings.hash_id = current_files.hash_id\n      LEFT JOIN file_inbox ON file_inbox.hash_id = current_files.hash_id\n    WHERE current_files.hash_id > ?\n    ORDER BY current_files.hash_id ASC\n    LIMIT ?\n  `}}startEach(e){return a(this,void 0,void 0,(function*(){const t=e.map((e=>(this.resetTotal(),this.service=e,{service:e,total:this.total()})));t.sort(((e,t)=>t.total-e.total));for(const{service:e,total:n}of t)0!==n&&(this.resetTotal(n),this.service=e,yield this.start(),this.useTemp=!0)}))}}t.default=i},6971:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.printProgress=t.elapsed=void 0;const r=a(n(4521)),i=a(n(5022)),o=a(n(5946));let s=null,l=0,u=Date.now();function c(e){const t=(Date.now()-e)/1e3;return t<1?`${Math.floor(1e3*t)}ms`:t<60?`${t.toFixed(2)}s`:t<3600?`${Math.floor(t/60)}:${Math.floor(t%60).toString().padStart(2,"0")}`:`${Math.floor(t/60/60)}:${Math.floor(t/60%60).toString().padStart(2,"0")}:${Math.floor(t%60).toString().padStart(2,"0")}`}t.elapsed=c,t.printProgress=function e(t,n){null!==s&&s!==n&&e(!0,s);const a="boolean"==typeof o.default.isTTY?o.default.isTTY:process.stdout.isTTY;let d,f;if("boolean"==typeof t?(d=t?20:0,f=t):(d=Math.min(Math.round(t[0]/t[1]*20),20),f=t[0]===t[1]),a){r.default.clearLine(process.stdout,0),r.default.cursorTo(process.stdout,0);let e=n;Array.isArray(t)&&(e+=` (${t[0]}/${t[1]})`),e=e.padEnd(32," "),e+=`${i.default.white("[")+i.default.cyan("#".repeat(d))+i.default.gray("-".repeat(20-d))+i.default.white("]")} `,f&&(e+=`${i.default.green.bold("Done")} in ${c(u)}\n`),process.stdout.write(e)}else{let e="";null===s&&(e+=n,Array.isArray(t)&&(e+=` (${t[1]})`),e=e.padEnd(32," "),e+="["),e+="#".repeat(d-l),f&&(e+=`] Done in ${c(u)}\n`),process.stdout.write(e)}f?(s=null,l=0):(null===s&&(u=Date.now()),l=d,s=n)}},7226:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(2854),r=n(6018);class i extends r.Import{constructor(e,t,n){super(e,t),this.services=n,this.display="Tag parents",this.initialKey=[-1,-1],this.outputTable="tag_parents",this.totalQuery=()=>`SELECT count(1) FROM tag_parents WHERE service_id IN (${this.services.join(", ")}) AND status=${a.ContentStatus.CURRENT}`,this.outputQuery=e=>`COPY ${e}(tagid, parentid) FROM STDIN (FORMAT CSV)`,this.inputQuery=()=>`\n    SELECT\n      child_tag_id,\n      parent_tag_id,\n      child_tag_id || ',' || parent_tag_id || '\n'\n    FROM tag_parents\n    WHERE service_id IN (${this.services.join(", ")}) AND status = ${a.ContentStatus.CURRENT} AND (child_tag_id, parent_tag_id) > (?, ?)\n    ORDER BY child_tag_id, parent_tag_id\n    LIMIT ?\n  `,this.useTemp=!0}}t.default=i},4291:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(2854),r=n(6018);class i extends r.Import{constructor(e,t,n){super(e,t),this.services=n,this.display="Tag siblings",this.outputTable="tag_siblings",this.totalQuery=()=>`SELECT count(1) FROM tag_siblings WHERE service_id IN (${this.services.join(", ")}) AND status=${a.ContentStatus.CURRENT}`,this.outputQuery=e=>`COPY ${e}(tagid, betterid) FROM STDIN (FORMAT CSV)`,this.inputQuery=()=>`\n    SELECT\n      bad_tag_id,\n      bad_tag_id || ',' || good_tag_id || '\n'\n    FROM tag_siblings\n    WHERE service_id IN (${this.services.join(", ")}) AND status = ${a.ContentStatus.CURRENT} AND bad_tag_id > ?\n    ORDER BY bad_tag_id\n    LIMIT ?\n  `,this.useTemp=!0}}t.default=i},8393:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(6018);class r extends a.Import{constructor(){super(...arguments),this.display="Tags",this.batchSizeMul=.5,this.outputTable="tags",this.totalQuery=()=>"SELECT count(1) FROM tags",this.outputQuery=e=>`COPY ${e}(id, name, subtag) FROM STDIN (FORMAT CSV)`,this.inputQuery=()=>"\n    SELECT\n      tags.tag_id,\n      REPLACE(\n        '' || tags.tag_id || ',\"' ||\n        LOWER(REPLACE(\n          CASE WHEN namespaces.namespace IS NOT NULL AND namespaces.namespace != ''\n            THEN namespaces.namespace || ':' || subtags.subtag\n            ELSE subtags.subtag\n          END,\n        '\"', '\"\"')) || '\",\"' ||\n        LOWER(REPLACE(\n          subtags.subtag,\n        '\"', '\"\"')) || '\"\n',\n      ' ', '_')\n    FROM tags\n      INNER JOIN subtags ON subtags.subtag_id = tags.subtag_id\n      INNER JOIN namespaces ON namespaces.namespace_id = tags.namespace_id\n    WHERE tags.tag_id > ?\n    ORDER BY tags.tag_id ASC\n    LIMIT ?\n  "}}t.default=r},5197:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(6018);class r extends a.Import{constructor(){super(...arguments),this.display="Urls",this.batchSizeMul=.5,this.outputTable="urls",this.totalQuery=()=>"SELECT count(1) FROM urls INNER JOIN url_map ON url_map.url_id = urls.url_id",this.outputQuery=e=>`COPY ${e}(id, postid, url) FROM STDIN (FORMAT CSV)`,this.inputQuery=()=>"\n    SELECT\n      urls.url_id,\n      urls.url_id || ',' ||\n      url_map.hash_id || ',\"' ||\n      REPLACE(urls.url, '\"', '\"\"') || '\"\n'\n    FROM urls\n      INNER JOIN url_map ON url_map.url_id = urls.url_id\n    WHERE urls.url_id > ?\n    ORDER BY urls.url_id\n    LIMIT ?\n  "}}t.default=r},5718:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preparePattern=void 0,t.preparePattern=e=>e.toLowerCase().replace(/\\/g,"\\\\").replace(/%/g,"\\%").replace(/[_ ]/g,"\\_").replace(/\*/g,"%").replace(/\?/g,"_")},846:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(2482));t.default=function(e,t,n){return o(this,void 0,void 0,(function*(){e.config=yield s.getConfig(),n()}))}},338:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(6689)),i=a(n(5022)),o=a(n(8684)),s=n(3308),l=n(8144),u=a(n(1390)),c=a(n(6948)),d=a(n(6015)),f=a(n(5946)),p=/[<>]/g,h={"<":"\\u003C",">":"\\u003E"};t.default=function(e,t,n){t.react=(n,a)=>{t.header("Cache-Control","private, no-cache, no-store, must-revalidate"),t.header("Expires","-1"),t.header("Pragma","no-cache");const E=e.cookies.theme||l.Theme.AUTO,m=(null==a?void 0:a.title)?`${null==a?void 0:a.title} | ${e.config.appName}`:e.config.appName;switch(e.accepts(["html","json"])){case"html":{if(null==a?void 0:a.htmlRedirect){t.redirect(a.htmlRedirect);break}const l=Object.assign(Object.assign({},n),{_config:e.config,_theme:E,_ssrError:!1});let d;try{d=o.default.renderToString(r.default.createElement(s.StaticRouter,{location:e.originalUrl,context:{}},r.default.createElement(u.default,{initialData:l})))}catch(e){console.error(i.default.red.bold("Error during SSR!")),console.error(e),d="There was an error during Server Side Rendering.",l._ssrError=!0}const g=JSON.stringify(l).replace(p,(e=>h[e]||e));t.send((0,c.default)({reactContent:d,initialData:g,production:!0,theme:E,title:m,appName:f.default.appName,description:f.default.appDescription,ogTitle:(null==a?void 0:a.ogTitle)||f.default.appName,ogDescription:(null==a?void 0:a.ogDescription)||f.default.appDescription,ogType:(null==a?void 0:a.ogTitle)||"website",ogImage:null==a?void 0:a.ogImage,ogAudio:null==a?void 0:a.ogAudio,ogVideo:null==a?void 0:a.ogVideo,ogUrl:(null==a?void 0:a.ogUrl)||`${e.protocol}://${e.get("host")}${e.originalUrl}`,ogSiteName:(null==a?void 0:a.ogSiteName)||f.default.appName}));break}case"json":t.json(Object.assign(Object.assign({},n),{_title:m}));break;default:throw new d.default(406)}return t},n()}},5193:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const l=s(n(3685)),u=s(n(5115)),c=s(n(5946)),d=s(n(6015)),f=i(n(2614)),p=i(n(7430)),h=i(n(605));t.router=(0,u.default)(),t.router.post("/regendb",((e,t)=>o(void 0,void 0,void 0,(function*(){if("string"!=typeof c.default.adminPassword)throw new d.default(400,"Admin password has not been set in configs.json");if(e.body.password!==c.default.adminPassword)throw new d.default(400,"Invalid Password");yield f.initialize(),t.json({ok:!0})})))),t.router.get("/post/:id",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=parseInt(e.params.id);let a;a=isNaN(n)?null:yield p.get(parseInt(e.params.id)),t.json(a)})))),t.router.get("/post",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield p.search(Object.assign(Object.assign({},e.query),{tags:!1}));t.json(n)})))),t.router.get("/tags",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield h.search(e.query);t.json(n)})))),t.router.use(((e,t)=>{throw new d.default(404)})),t.router.use(((e,t,n,a)=>{console.error(e);const r=e.HTTPcode||500,i={code:r,message:e.publicMessage||l.default.STATUS_CODES[r],stack:void 0};n.status(r).json({_error:i})}))},6918:(e,t)=>{"use strict";var n,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailsMode=t.Relation=void 0,(a=t.Relation||(t.Relation={})).DUPLICATE="DUPLICATE",a.DUPLICATE_BEST="DUPLICATE_BEST",a.ALTERNATE="ALTERNATE",(n=t.ThumbnailsMode||(t.ThumbnailsMode={})).FILL="fill",n.FIT="fit"},9941:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const l=s(n(1017)),u=s(n(5115)),c=i(n(2614)),d=s(n(5946)),f=s(n(6015));t.router=(0,u.default)(),t.router.get("/:filename",((e,t,n)=>o(void 0,void 0,void 0,(function*(){let a=l.default.resolve(c.findHydrusDB(),"client_files");e.params.filename.startsWith("t")&&d.default.posts.thumbnailsPathOverride?a=d.default.posts.thumbnailsPathOverride:d.default.posts.filesPathOverride&&(a=d.default.posts.filesPathOverride);let r=e.params.filename;r=`./${r.substr(0,3)}/${r.substr(1)}`,t.sendFile(r,{root:a},(e=>{e&&"ENOENT"===e.code?n(new f.default(404)):e&&n(e)}))}))))},2779:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const s=o(n(5115)),l=i(n(5193)),u=i(n(9941)),c=i(n(7660));t.router=(0,s.default)(),t.router.use("/api",l.router),t.router.use("/files",u.router),t.router.use("/",c.router)},7660:function(e,t,n){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t},o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const l=s(n(5115)),u=n(8144),c=n(9261),d=n(2854),f=s(n(5946)),p=s(n(489)),h=i(n(4694)),E=i(n(7430)),m=i(n(2482)),g=i(n(605));function _(e,t){const n=null!==t.mime&&d.MIME_STRING[t.mime]||null,a=(0,d.fileUrl)(t);(null==n?void 0:n.startsWith("image/"))?e.ogImage={url:a,type:n,width:"width"in t&&t.width||0,height:"height"in t&&t.height||0,alt:t.id.toString()}:(null==n?void 0:n.startsWith("video/"))?e.ogVideo={url:a,type:n,width:"width"in t&&t.width||0,height:"height"in t&&t.height||0,duration:"duration"in t&&t.duration||0}:(null==n?void 0:n.startsWith("audio/"))&&(e.ogAudio={url:a,type:n})}t.router=(0,l.default)(),t.router.get("/posts/:id",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=parseInt(e.params.id);let a;a=isNaN(n)?null:yield E.get(parseInt(e.params.id));const r={ogUrl:`${e.protocol}://${e.get("host")}/post/${e.params.id}`};if(a){r.ogTitle=r.title=(0,d.postTitle)(a);const e=Object.keys(a.tags),t=e.filter((e=>e.match(d.namespaceRegex))).sort(),n=e.filter((e=>!e.match(d.namespaceRegex))).sort();r.ogDescription=[...t,...n].slice(0,128).map(d.prettifyTag).join(", "),_(r,a)}t.react({post:a},r)})))),t.router.get("/posts",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield E.search(Object.assign(Object.assign({},e.query),{tags:!0,blurhash:!0}));t.react({results:n},{ogTitle:"Post Search",ogDescription:e.query.query})})))),t.router.get("/tags",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield g.search(Object.assign(Object.assign({},e.query),{full:!0}));t.react({results:n},{ogTitle:"Tag Search",ogDescription:e.query.query})})))),t.router.get("/random",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield E.random(e.query.query),a=n?`/posts/${n.id}${(0,c.qsStringify)(e.query)}`:`/posts${(0,c.qsStringify)(e.query)}`;t.react({redirect:a},{ogTitle:"Random Post",ogDescription:e.query.query,htmlRedirect:a})})))),t.router.post("/setTheme",((e,t)=>o(void 0,void 0,void 0,(function*(){t.cookie("theme",e.body.theme,{maxAge:307584e5}),t.redirect(e.body.redirectUrl||"/")})))),t.router.get("/",((e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield m.getStats(),a=e.cookies.theme||u.Theme.AUTO;let r;f.default.tags.motd&&"object"==typeof f.default.tags.motd?r=f.default.tags.motd[a]:f.default.tags.motd&&(r=f.default.tags.motd);const i="string"==typeof r&&(yield E.random(r))||null,o={ogTitle:"Main Page"},s=yield h.getReleases();let l=null;if(s.length>0){const t=s[0];`v${e.config.version}`!==t.tag_name&&(l=t.html_url)}i&&_(o,i),t.react({stats:n,updateUrl:l,motd:i},o)})))),t.router.get("/opensearch.xml",((e,t)=>o(void 0,void 0,void 0,(function*(){t.setHeader("Content-Type","application/opensearchdescription+xml"),t.end((0,p.default)({appName:f.default.appName,appDescription:f.default.appDescription,origin:`${e.protocol}://${e.get("host")}`}))})))),t.router.get("/test",((e,t)=>o(void 0,void 0,void 0,(function*(){t.react({})}))))},6948:(e,t,n)=>{var a=n(202);e.exports=(a.default||a).template({1:function(e,t,n,a,r){var i,o,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<meta property="og:title" content="'+(null!=(i="function"==typeof(o=null!=(o=s(n,"ogTitle")||(null!=t?s(t,"ogTitle"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"ogTitle",hash:{},data:r,loc:{start:{line:11,column:58},end:{line:11,column:71}}}):o)?i:"")+'" />'},3:function(e,t,n,a,r){var i,o,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<meta property="og:description" content="'+(null!=(i="function"==typeof(o=null!=(o=s(n,"ogDescription")||(null!=t?s(t,"ogDescription"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"ogDescription",hash:{},data:r,loc:{start:{line:12,column:70},end:{line:12,column:89}}}):o)?i:"")+'" />'},5:function(e,t,n,a,r){var i,o,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<meta property="og:type" content="'+(null!=(i="function"==typeof(o=null!=(o=s(n,"ogType")||(null!=t?s(t,"ogType"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"ogType",hash:{},data:r,loc:{start:{line:13,column:56},end:{line:13,column:68}}}):o)?i:"")+'" />'},7:function(e,t,n,a,r){var i,o=e.lambda,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <meta property="og:image" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogImage"):t)?s(i,"url"):i,t))?i:"")+'" />\n            <meta property="og:image:type" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogImage"):t)?s(i,"type"):i,t))?i:"")+'" />\n            <meta property="og:image:width" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogImage"):t)?s(i,"width"):i,t))?i:"")+'" />\n            <meta property="og:image:height" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogImage"):t)?s(i,"height"):i,t))?i:"")+'" />\n            <meta property="og:image:alt" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogImage"):t)?s(i,"alt"):i,t))?i:"")+'" />\n'},9:function(e,t,n,a,r){var i,o=e.lambda,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <meta property="og:video" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogVideo"):t)?s(i,"url"):i,t))?i:"")+'" />\n            <meta property="og:video:type" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogVideo"):t)?s(i,"type"):i,t))?i:"")+'" />\n            <meta property="og:video:width" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogVideo"):t)?s(i,"width"):i,t))?i:"")+'" />\n            <meta property="og:video:height" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogVideo"):t)?s(i,"height"):i,t))?i:"")+'" />\n'},11:function(e,t,n,a,r){var i,o=e.lambda,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <meta property="og:audio" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogAudio"):t)?s(i,"url"):i,t))?i:"")+'" />\n            <meta property="og:audio:type" content="'+(null!=(i=o(null!=(i=null!=t?s(t,"ogAudio"):t)?s(i,"type"):i,t))?i:"")+'" />\n'},13:function(e,t,n,a,r){var i,o,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<meta property="og:url" content="'+(null!=(i="function"==typeof(o=null!=(o=s(n,"ogUrl")||(null!=t?s(t,"ogUrl"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"ogUrl",hash:{},data:r,loc:{start:{line:31,column:54},end:{line:31,column:65}}}):o)?i:"")+'" />'},15:function(e,t,n,a,r){var i,o,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<meta property="og:site_name" content="'+(null!=(i="function"==typeof(o=null!=(o=s(n,"ogSiteName")||(null!=t?s(t,"ogSiteName"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"ogSiteName",hash:{},data:r,loc:{start:{line:32,column:65},end:{line:32,column:81}}}):o)?i:"")+'" />'},17:function(e,t,n,a,r){return'\t\t\t<link rel="stylesheet" href="/style.css"/>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,a,r){var i,o,s=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<!doctype html>\n<html lang="en" class="'+(null!=(i=typeof(o=null!=(o=c(n,"theme")||(null!=t?c(t,"theme"):t))?o:l)===u?o.call(s,{name:"theme",hash:{},data:r,loc:{start:{line:2,column:23},end:{line:2,column:34}}}):o)?i:"")+'">\n\t<head>\n\t\t<title>'+(null!=(i=typeof(o=null!=(o=c(n,"title")||(null!=t?c(t,"title"):t))?o:l)===u?o.call(s,{name:"title",hash:{},data:r,loc:{start:{line:4,column:9},end:{line:4,column:20}}}):o)?i:"")+'</title>\n        <meta charset="utf-8">\n        <meta name="description" content="'+(null!=(i=typeof(o=null!=(o=c(n,"description")||(null!=t?c(t,"description"):t))?o:l)===u?o.call(s,{name:"description",hash:{},data:r,loc:{start:{line:6,column:42},end:{line:6,column:59}}}):o)?i:"")+'">\n        <meta name="keywords" content="gallery, imageboard, hybooru, hydrus, arts, anime, memes">\n        <meta name="author" content="Fun Maker">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n\n        '+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogTitle"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:11,column:8},end:{line:11,column:82}}}))?i:"")+"\n        "+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogDescription"):t,{name:"if",hash:{},fn:e.program(3,r,0),inverse:e.noop,data:r,loc:{start:{line:12,column:8},end:{line:12,column:100}}}))?i:"")+"\n        "+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogType"):t,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r,loc:{start:{line:13,column:8},end:{line:13,column:79}}}))?i:"")+"\n"+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogImage"):t,{name:"if",hash:{},fn:e.program(7,r,0),inverse:e.noop,data:r,loc:{start:{line:14,column:8},end:{line:20,column:15}}}))?i:"")+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogVideo"):t,{name:"if",hash:{},fn:e.program(9,r,0),inverse:e.noop,data:r,loc:{start:{line:21,column:8},end:{line:26,column:15}}}))?i:"")+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogAudio"):t,{name:"if",hash:{},fn:e.program(11,r,0),inverse:e.noop,data:r,loc:{start:{line:27,column:8},end:{line:30,column:15}}}))?i:"")+"        "+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogUrl"):t,{name:"if",hash:{},fn:e.program(13,r,0),inverse:e.noop,data:r,loc:{start:{line:31,column:8},end:{line:31,column:76}}}))?i:"")+"\n        "+(null!=(i=c(n,"if").call(s,null!=t?c(t,"ogSiteName"):t,{name:"if",hash:{},fn:e.program(15,r,0),inverse:e.noop,data:r,loc:{start:{line:32,column:8},end:{line:32,column:92}}}))?i:"")+'\n\n        <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">\n        <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">\n        <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">\n        <link rel="manifest" href="/static/favicon/site.webmanifest">\n        <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#148cff">\n        <link rel="shortcut icon" href="/static/favicon/favicon.ico">\n        <meta name="msapplication-TileColor" content="#2d89ef">\n        <meta name="msapplication-config" content="/static/favicon/browserconfig.xml">\n        <meta name="theme-color" content="#148cff">\n\n        <link rel="search" type="application/opensearchdescription+xml" title="'+(null!=(i=typeof(o=null!=(o=c(n,"appName")||(null!=t?c(t,"appName"):t))?o:l)===u?o.call(s,{name:"appName",hash:{},data:r,loc:{start:{line:44,column:79},end:{line:44,column:92}}}):o)?i:"")+'" href="/opensearch.xml">\n'+(null!=(i=c(n,"if").call(s,null!=t?c(t,"production"):t,{name:"if",hash:{},fn:e.program(17,r,0),inverse:e.noop,data:r,loc:{start:{line:45,column:8},end:{line:47,column:9}}}))?i:"")+'\t</head>\n\t<body>\n\t\t<div id="root">'+(null!=(i=typeof(o=null!=(o=c(n,"reactContent")||(null!=t?c(t,"reactContent"):t))?o:l)===u?o.call(s,{name:"reactContent",hash:{},data:r,loc:{start:{line:50,column:17},end:{line:50,column:35}}}):o)?i:"")+'</div>\n\t\t<script id="initialData" type="application/json">'+(null!=(i=typeof(o=null!=(o=c(n,"initialData")||(null!=t?c(t,"initialData"):t))?o:l)===u?o.call(s,{name:"initialData",hash:{},data:r,loc:{start:{line:51,column:51},end:{line:51,column:68}}}):o)?i:"")+'<\/script>\n\n\t\t<script type="text/javascript" src="/client.js"><\/script>\n\t</body>\n</html>\n'},useData:!0})},489:(e,t,n)=>{var a=n(202);e.exports=(a.default||a).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,a,r){var i,o,s=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,u="function",c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<?xml version="1.0" encoding="UTF-8"?>\n<OpenSearchDescription xmlns="http://a9.com/-/spec/opensearch/1.1/">\n    <ShortName>'+(null!=(i=typeof(o=null!=(o=c(n,"appName")||(null!=t?c(t,"appName"):t))?o:l)===u?o.call(s,{name:"appName",hash:{},data:r,loc:{start:{line:3,column:15},end:{line:3,column:28}}}):o)?i:"")+"</ShortName>\n    <Description>"+(null!=(i=typeof(o=null!=(o=c(n,"appDescription")||(null!=t?c(t,"appDescription"):t))?o:l)===u?o.call(s,{name:"appDescription",hash:{},data:r,loc:{start:{line:4,column:17},end:{line:4,column:37}}}):o)?i:"")+'</Description>\n    <InputEncoding>UTF-8</InputEncoding>\n    <Image width="32" height="32" type="image/png">'+(null!=(i=typeof(o=null!=(o=c(n,"origin")||(null!=t?c(t,"origin"):t))?o:l)===u?o.call(s,{name:"origin",hash:{},data:r,loc:{start:{line:6,column:51},end:{line:6,column:63}}}):o)?i:"")+'/static/favicon/favicon-32x32.png</Image>\n    <Url type="text/html" method="get" template="'+(null!=(i=typeof(o=null!=(o=c(n,"origin")||(null!=t?c(t,"origin"):t))?o:l)===u?o.call(s,{name:"origin",hash:{},data:r,loc:{start:{line:7,column:49},end:{line:7,column:61}}}):o)?i:"")+'/posts?query={searchTerms}"></Url>\n</OpenSearchDescription>\n'},useData:!0})},6834:(e,t,n)=>{"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=r(n(2067)),o=a(n(5558)),s=a(n(8728)),l=r(n(2392)),u=r(n(1628)),c=a(n(3982));function d(){var e=new i.HandlebarsEnvironment;return l.extend(e,i),e.SafeString=o.default,e.Exception=s.default,e.Utils=l,e.escapeExpression=l.escapeExpression,e.VM=u,e.template=function(t){return u.template(t,e)},e}var f=d();f.create=d,c.default(f),f.default=f,t.default=f,e.exports=t.default},2067:(e,t,n)=>{"use strict";function a(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.HandlebarsEnvironment=d;var r=n(2392),i=a(n(8728)),o=n(2638),s=n(881),l=a(n(8037)),u=n(6293);t.VERSION="4.7.7",t.COMPILER_REVISION=8,t.LAST_COMPATIBLE_COMPILER_REVISION=7,t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var c="[object Object]";function d(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},o.registerDefaultHelpers(this),s.registerDefaultDecorators(this)}d.prototype={constructor:d,logger:l.default,log:l.default.log,registerHelper:function(e,t){if(r.toString.call(e)===c){if(t)throw new i.default("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(r.toString.call(e)===c)r.extend(this.partials,e);else{if(void 0===t)throw new i.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(r.toString.call(e)===c){if(t)throw new i.default("Arg not supported with multiple decorators");r.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){u.resetLoggedProperties()}};var f=l.default.log;t.log=f,t.createFrame=r.createFrame,t.logger=l.default},881:(e,t,n)=>{"use strict";t.__esModule=!0,t.registerDefaultDecorators=function(e){r.default(e)};var a,r=(a=n(5670))&&a.__esModule?a:{default:a}},5670:(e,t,n)=>{"use strict";t.__esModule=!0;var a=n(2392);t.default=function(e){e.registerDecorator("inline",(function(e,t,n,r){var i=e;return t.partials||(t.partials={},i=function(r,i){var o=n.partials;n.partials=a.extend({},o,t.partials);var s=e(r,i);return n.partials=o,s}),t.partials[r.args[0]]=r.fn,i}))},e.exports=t.default},8728:(e,t)=>{"use strict";t.__esModule=!0;var n=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function a(e,t){var r=t&&t.loc,i=void 0,o=void 0,s=void 0,l=void 0;r&&(i=r.start.line,o=r.end.line,s=r.start.column,l=r.end.column,e+=" - "+i+":"+s);for(var u=Error.prototype.constructor.call(this,e),c=0;c<n.length;c++)this[n[c]]=u[n[c]];Error.captureStackTrace&&Error.captureStackTrace(this,a);try{r&&(this.lineNumber=i,this.endLineNumber=o,Object.defineProperty?(Object.defineProperty(this,"column",{value:s,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:l,enumerable:!0})):(this.column=s,this.endColumn=l))}catch(e){}}a.prototype=new Error,t.default=a,e.exports=t.default},2638:(e,t,n)=>{"use strict";function a(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.registerDefaultHelpers=function(e){r.default(e),i.default(e),o.default(e),s.default(e),l.default(e),u.default(e),c.default(e)},t.moveHelperToHooks=function(e,t,n){e.helpers[t]&&(e.hooks[t]=e.helpers[t],n||delete e.helpers[t])};var r=a(n(7342)),i=a(n(6822)),o=a(n(4905)),s=a(n(7405)),l=a(n(5702)),u=a(n(7593)),c=a(n(3978))},7342:(e,t,n)=>{"use strict";t.__esModule=!0;var a=n(2392);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,n){var r=n.inverse,i=n.fn;if(!0===t)return i(this);if(!1===t||null==t)return r(this);if(a.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):r(this);if(n.data&&n.ids){var o=a.createFrame(n.data);o.contextPath=a.appendContextPath(n.data.contextPath,n.name),n={data:o}}return i(t,n)}))},e.exports=t.default},6822:(e,t,n)=>{"use strict";t.__esModule=!0;var a,r=n(2392),i=(a=n(8728))&&a.__esModule?a:{default:a};t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new i.default("Must pass iterator to #each");var n,a=t.fn,o=t.inverse,s=0,l="",u=void 0,c=void 0;function d(t,n,i){u&&(u.key=t,u.index=n,u.first=0===n,u.last=!!i,c&&(u.contextPath=c+t)),l+=a(e[t],{data:u,blockParams:r.blockParams([e[t],t],[c+t,null])})}if(t.data&&t.ids&&(c=r.appendContextPath(t.data.contextPath,t.ids[0])+"."),r.isFunction(e)&&(e=e.call(this)),t.data&&(u=r.createFrame(t.data)),e&&"object"==typeof e)if(r.isArray(e))for(var f=e.length;s<f;s++)s in e&&d(s,s,s===e.length-1);else if(global.Symbol&&e[global.Symbol.iterator]){for(var p=[],h=e[global.Symbol.iterator](),E=h.next();!E.done;E=h.next())p.push(E.value);for(f=(e=p).length;s<f;s++)d(s,s,s===e.length-1)}else n=void 0,Object.keys(e).forEach((function(e){void 0!==n&&d(n,s-1),n=e,s++})),void 0!==n&&d(n,s-1,!0);return 0===s&&(l=o(this)),l}))},e.exports=t.default},4905:(e,t,n)=>{"use strict";t.__esModule=!0;var a,r=(a=n(8728))&&a.__esModule?a:{default:a};t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new r.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},7405:(e,t,n)=>{"use strict";t.__esModule=!0;var a,r=n(2392),i=(a=n(8728))&&a.__esModule?a:{default:a};t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new i.default("#if requires exactly one argument");return r.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,n){if(2!=arguments.length)throw new i.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}))},e.exports=t.default},5702:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],n=arguments[arguments.length-1],a=0;a<arguments.length-1;a++)t.push(arguments[a]);var r=1;null!=n.hash.level?r=n.hash.level:n.data&&null!=n.data.level&&(r=n.data.level),t[0]=r,e.log.apply(e,t)}))},e.exports=t.default},7593:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",(function(e,t,n){return e?n.lookupProperty(e,t):e}))},e.exports=t.default},3978:(e,t,n)=>{"use strict";t.__esModule=!0;var a,r=n(2392),i=(a=n(8728))&&a.__esModule?a:{default:a};t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new i.default("#with requires exactly one argument");r.isFunction(e)&&(e=e.call(this));var n=t.fn;if(r.isEmpty(e))return t.inverse(this);var a=t.data;return t.data&&t.ids&&((a=r.createFrame(t.data)).contextPath=r.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:a,blockParams:r.blockParams([e],[a&&a.contextPath])})}))},e.exports=t.default},8572:(e,t,n)=>{"use strict";t.__esModule=!0,t.createNewLookupObject=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.extend.apply(void 0,[Object.create(null)].concat(t))};var a=n(2392)},6293:(e,t,n)=>{"use strict";t.__esModule=!0,t.createProtoAccessControl=function(e){var t=Object.create(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var n=Object.create(null);return n.__proto__=!1,{properties:{whitelist:a.createNewLookupObject(n,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:a.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},t.resultIsAllowed=function(e,t,n){return function(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==i[e]&&(i[e]=!0,r.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}("function"==typeof e?t.methods:t.properties,n)},t.resetLoggedProperties=function(){Object.keys(i).forEach((function(e){delete i[e]}))};var a=n(8572),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(8037)),i=Object.create(null)},5005:(e,t)=>{"use strict";t.__esModule=!0,t.wrapHelper=function(e,t){return"function"!=typeof e?e:function(){var n=arguments[arguments.length-1];return arguments[arguments.length-1]=t(n),e.apply(this,arguments)}}},8037:(e,t,n)=>{"use strict";t.__esModule=!0;var a=n(2392),r={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=a.indexOf(r.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=r.lookupLevel(e),"undefined"!=typeof console&&r.lookupLevel(r.level)<=e){var t=r.methodMap[e];console[t]||(t="log");for(var n=arguments.length,a=Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];console[t].apply(console,a)}}};t.default=r,e.exports=t.default},3982:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e){var t="undefined"!=typeof global?global:window,n=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=n),e}},e.exports=t.default},1628:(e,t,n)=>{"use strict";t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=o.COMPILER_REVISION;if(!(t>=o.LAST_COMPATIBLE_COMPILER_REVISION&&t<=o.COMPILER_REVISION)){if(t<o.LAST_COMPATIBLE_COMPILER_REVISION){var a=o.REVISION_CHANGES[n],r=o.REVISION_CHANGES[t];throw new i.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+a+") or downgrade your runtime to an older version ("+r+").")}throw new i.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new i.default("No environment passed to template");if(!e||!e.main)throw new i.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var n=e.compiler&&7===e.compiler[0],a={strict:function(e,t,n){if(!e||!(t in e))throw new i.default('"'+t+'" not defined in '+e,{loc:n});return a.lookupProperty(e,t)},lookupProperty:function(e,t){var n=e[t];return null==n||Object.prototype.hasOwnProperty.call(e,t)||u.resultIsAllowed(n,a.protoAccessControl,t)?n:void 0},lookup:function(e,t){for(var n=e.length,r=0;r<n;r++)if(null!=(e[r]&&a.lookupProperty(e[r],t)))return e[r][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:r.escapeExpression,invokePartial:function(n,a,o){o.hash&&(a=r.extend({},a,o.hash),o.ids&&(o.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,a,o);var s=r.extend({},o,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),l=t.VM.invokePartial.call(this,n,a,s);if(null==l&&t.compile&&(o.partials[o.name]=t.compile(n,e.compilerOptions,t),l=o.partials[o.name](a,s)),null!=l){if(o.indent){for(var u=l.split("\n"),c=0,d=u.length;c<d&&(u[c]||c+1!==d);c++)u[c]=o.indent+u[c];l=u.join("\n")}return l}throw new i.default("The partial "+o.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,a,r){var i=this.programs[e],o=this.fn(e);return t||r||a||n?i=c(this,e,o,t,n,a,r):i||(i=this.programs[e]=c(this,e,o)),i},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=r.extend({},t,e)),n},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};function o(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=n.data;o._setup(n),!n.partial&&e.useData&&(r=f(t,r));var i=void 0,s=e.useBlockParams?[]:void 0;function l(t){return""+e.main(a,t,a.helpers,a.partials,r,s,i)}return e.useDepths&&(i=n.depths?t!=n.depths[0]?[t].concat(n.depths):n.depths:[t]),(l=p(e.main,l,a,n.depths||[],r,s))(t,n)}return o.isTop=!0,o._setup=function(i){if(i.partial)a.protoAccessControl=i.protoAccessControl,a.helpers=i.helpers,a.partials=i.partials,a.decorators=i.decorators,a.hooks=i.hooks;else{var o=r.extend({},t.helpers,i.helpers);!function(e,t){Object.keys(e).forEach((function(n){var a=e[n];e[n]=function(e,t){var n=t.lookupProperty;return l.wrapHelper(e,(function(e){return r.extend({lookupProperty:n},e)}))}(a,t)}))}(o,a),a.helpers=o,e.usePartial&&(a.partials=a.mergeIfNeeded(i.partials,t.partials)),(e.usePartial||e.useDecorators)&&(a.decorators=r.extend({},t.decorators,i.decorators)),a.hooks={},a.protoAccessControl=u.createProtoAccessControl(i);var c=i.allowCallsToHelperMissing||n;s.moveHelperToHooks(a,"helperMissing",c),s.moveHelperToHooks(a,"blockHelperMissing",c)}},o._child=function(t,n,r,o){if(e.useBlockParams&&!r)throw new i.default("must pass block params");if(e.useDepths&&!o)throw new i.default("must pass parent depths");return c(a,t,e[t],n,0,r,o)},o},t.wrapProgram=c,t.resolvePartial=function(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e},t.invokePartial=function(e,t,n){var a=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var s=void 0;if(n.fn&&n.fn!==d&&function(){n.data=o.createFrame(n.data);var e=n.fn;s=n.data["partial-block"]=function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.data=o.createFrame(n.data),n.data["partial-block"]=a,e(t,n)},e.partials&&(n.partials=r.extend({},n.partials,e.partials))}(),void 0===e&&s&&(e=s),void 0===e)throw new i.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=d;var a,r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(2392)),i=(a=n(8728))&&a.__esModule?a:{default:a},o=n(2067),s=n(2638),l=n(5005),u=n(6293);function c(e,t,n,a,r,i,o){function s(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=o;return!o||t==o[0]||t===e.nullContext&&null===o[0]||(s=[t].concat(o)),n(e,t,e.helpers,e.partials,r.data||a,i&&[r.blockParams].concat(i),s)}return(s=p(n,s,e,o,a,i)).program=t,s.depth=o?o.length:0,s.blockParams=r||0,s}function d(){return""}function f(e,t){return t&&"root"in t||((t=t?o.createFrame(t):{}).root=e),t}function p(e,t,n,a,i,o){if(e.decorator){var s={};t=e.decorator(t,s,n,a&&a[0],i,o,a),r.extend(t,s)}return t}},5558:(e,t)=>{"use strict";function n(e){this.string=e}t.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t.default=n,e.exports=t.default},2392:(e,t)=>{"use strict";t.__esModule=!0,t.extend=o,t.indexOf=function(e,t){for(var n=0,a=e.length;n<a;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return r.test(e)?e.replace(a,i):e},t.isEmpty=function(e){return!e&&0!==e||!(!u(e)||0!==e.length)},t.createFrame=function(e){var t=o({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},a=/[&<>"'`=]/g,r=/[&<>"'`=]/;function i(e){return n[e]}function o(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}var s=Object.prototype.toString;t.toString=s;var l=function(e){return"function"==typeof e};l(/x/)&&(t.isFunction=l=function(e){return"function"==typeof e&&"[object Function]"===s.call(e)}),t.isFunction=l;var u=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===s.call(e)};t.isArray=u},202:(e,t,n)=>{e.exports=n(6834).default},7917:()=>{},9268:()=>{},2427:()=>{},3838:()=>{},1376:()=>{},1345:()=>{},8562:()=>{},9358:()=>{},1044:()=>{},7515:()=>{},5206:()=>{},7563:()=>{},4751:()=>{},3158:()=>{},7359:()=>{},2984:()=>{},9107:()=>{},8198:()=>{},6222:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a="\nDELETE FROM urls WHERE NOT EXISTS (SELECT 1 FROM posts WHERE id = postid);\nCREATE INDEX ON urls(postid);\nALTER TABLE urls ADD CONSTRAINT urls_postid_fkey FOREIGN KEY (postid) REFERENCES posts(id) ON DELETE CASCADE;\n\nDELETE FROM notes WHERE NOT EXISTS (SELECT 1 FROM posts WHERE id = postid);\nCREATE INDEX ON notes(postid);\nALTER TABLE notes ADD CONSTRAINT notes_postid_fkey FOREIGN KEY (postid) REFERENCES posts(id) ON DELETE CASCADE;\n\nDELETE FROM mappings WHERE NOT EXISTS (SELECT 1 FROM posts WHERE id = postid);\nDELETE FROM mappings WHERE NOT EXISTS (SELECT 1 FROM tags WHERE id = tagid);\nDELETE FROM tags WHERE NOT EXISTS (SELECT 1 FROM mappings WHERE mappings.tagid = tags.id)\n                   AND NOT EXISTS (SELECT 1\n                                   FROM mappings\n                                   INNER JOIN tag_siblings ON tag_siblings.betterid = mappings.tagid\n                                   WHERE tag_siblings.tagid = tags.id);\nALTER TABLE mappings ADD CONSTRAINT mappings_postid_fkey FOREIGN KEY (postid) REFERENCES posts(id) ON DELETE CASCADE,\n                     ADD CONSTRAINT mappings_tagid_fkey FOREIGN KEY (tagid) REFERENCES tags(id) ON DELETE CASCADE;\nCREATE INDEX ON mappings(tagid);\nCREATE INDEX tags_name_idx ON tags USING gin(name gin_trgm_ops);\nCREATE INDEX tags_subtag_idx ON tags USING gin(subtag gin_trgm_ops);\n\nDROP TABLE IF EXISTS tag_postids;\nCREATE TABLE tag_postids AS\n  SELECT tagid, sort(array_agg(postid)) AS postids\n  FROM mappings\n  GROUP BY tagid;\nCREATE UNIQUE INDEX ON tag_postids(tagid);\n\nCREATE INDEX ON posts(posted, id);\nCREATE INDEX ON posts(rating, id);\nCREATE INDEX ON posts(size, id);\nCREATE UNIQUE INDEX ON posts(sha256);\nCREATE INDEX ON posts(md5);\n\nDELETE FROM relations WHERE NOT EXISTS (SELECT 1 FROM posts WHERE id = postid);\nDELETE FROM relations WHERE NOT EXISTS (SELECT 1 FROM posts WHERE id = other_postid);\nALTER TABLE relations ADD CONSTRAINT relations_postid_fkey FOREIGN KEY (postid) REFERENCES posts(id) ON DELETE CASCADE,\n                      ADD CONSTRAINT relations_other_postid_fkey FOREIGN KEY (other_postid) REFERENCES posts(id) ON DELETE CASCADE;\n"},9096:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a="CREATE EXTENSION IF NOT EXISTS pg_trgm;\nCREATE EXTENSION IF NOT EXISTS intarray;\n\nDROP TABLE IF EXISTS meta CASCADE;\nCREATE TABLE meta (\n  id INTEGER PRIMARY KEY DEFAULT 39,\n  hash INTEGER DEFAULT 0\n);\n\nINSERT INTO meta DEFAULT VALUES;\n\nCREATE OR REPLACE FUNCTION format_date(TIMESTAMPTZ) RETURNS TEXT\n  AS $$ SELECT to_char($1 AT TIME ZONE 'UTC', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"'); $$\n  LANGUAGE SQL\n  IMMUTABLE\n  RETURNS NULL ON NULL INPUT;\n\n\nCREATE OR REPLACE FUNCTION array_union(acc INTEGER[], val INTEGER[]) RETURNS INTEGER[]\n   AS $$ SELECT acc | val; $$\n   LANGUAGE SQL IMMUTABLE STRICT PARALLEL SAFE;\n\nCREATE OR REPLACE AGGREGATE union_agg (INTEGER[]) (\n  SFUNC = array_union,\n  STYPE = INTEGER[],\n  INITCOND = '{}',\n  PARALLEL = SAFE\n);\n\nCREATE OR REPLACE FUNCTION array_intersection(acc INTEGER[], val INTEGER[]) RETURNS INTEGER[]\n   AS $$ SELECT acc & val; $$\n   LANGUAGE SQL IMMUTABLE STRICT PARALLEL SAFE;\n\nCREATE OR REPLACE FUNCTION array_intersection_final(val INTEGER[]) RETURNS INTEGER[]\n   AS $$ SELECT COALESCE(val, '{}'); $$\n   LANGUAGE SQL IMMUTABLE PARALLEL SAFE;\n\nCREATE OR REPLACE AGGREGATE intersection_agg (INTEGER[]) (\n  SFUNC = array_intersection,\n  FINALFUNC = array_intersection_final,\n  STYPE = INTEGER[],\n  PARALLEL = SAFE\n);\n\n\nDROP TABLE IF EXISTS global CASCADE;\nCREATE TABLE global (\n  id INTEGER PRIMARY KEY DEFAULT 39,\n  thumbnail_width INTEGER NOT NULL,\n  thumbnail_height INTEGER NOT NULL,\n  posts INTEGER NOT NULL,\n  tags INTEGER NOT NULL,\n  mappings INTEGER NOT NULL,\n  needs_tags INTEGER NOT NULL,\n  rating_stars INTEGER\n);\n\nDROP TABLE IF EXISTS posts CASCADE;\nCREATE TABLE posts (\n  id INTEGER PRIMARY KEY,\n  sha256 BYTEA NOT NULL,\n  md5 BYTEA,\n  blurhash TEXT,\n  size BIGINT,\n  width INTEGER,\n  height INTEGER,\n  duration FLOAT,\n  num_frames INTEGER,\n  has_audio BOOLEAN,\n  rating FLOAT,\n  mime INTEGER,\n  inbox BOOLEAN NOT NULL,\n  trash BOOLEAN NOT NULL,\n  posted TIMESTAMPTZ NOT NULL DEFAULT NOW()\n);\n\nDROP TABLE IF EXISTS relations CASCADE;\nCREATE TABLE relations (\n  postid INTEGER NOT NULL,\n  other_postid INTEGER NOT NULL,\n  kind TEXT NOT NULL,\n\n  PRIMARY KEY(postid, other_postid)\n);\n\nDROP TABLE IF EXISTS urls CASCADE;\nCREATE TABLE urls (\n  id INTEGER,\n  postid INTEGER NOT NULL,\n  url TEXT NOT NULL,\n\n  PRIMARY KEY(id, postid)\n);\n\nDROP TABLE IF EXISTS notes CASCADE;\nCREATE TABLE notes (\n  id INTEGER,\n  postid INTEGER NOT NULL,\n  label TEXT NOT NULL,\n  note TEXT NOT NULL,\n\n  PRIMARY KEY(id, postid)\n);\n\nDROP TABLE IF EXISTS tags CASCADE;\nCREATE TABLE tags (\n  id INTEGER PRIMARY KEY,\n  name TEXT NOT NULL,\n  subtag TEXT NOT NULL,\n  used INTEGER NOT NULL DEFAULT 0\n);\n\nDROP TABLE IF EXISTS namespaces CASCADE;\nCREATE TABLE namespaces (\n  id INTEGER PRIMARY KEY,\n  name TEXT,\n  color TEXT NOT NULL\n);\n\nDROP TABLE IF EXISTS mappings CASCADE;\nCREATE TABLE mappings (\n  postid INTEGER NOT NULL,\n  tagid INTEGER NOT NULL,\n\n  PRIMARY KEY(postid, tagid)\n);\n\nDROP TABLE IF EXISTS tag_parents CASCADE;\nCREATE TABLE tag_parents (\n  tagid INTEGER NOT NULL,\n  parentid INTEGER NOT NULL,\n\n  PRIMARY KEY(tagid, parentid)\n);\n\nDROP TABLE IF EXISTS tag_siblings CASCADE;\nCREATE TABLE tag_siblings (\n  tagid INTEGER NOT NULL,\n  betterid INTEGER NOT NULL,\n\n  PRIMARY KEY(tagid, betterid)\n);\n"},6142:e=>{"use strict";e.exports=require("@octokit/core")},325:e=>{"use strict";e.exports=require("@ruffle-rs/ruffle")},2167:e=>{"use strict";e.exports=require("axios")},5890:e=>{"use strict";e.exports=require("better-sqlite3")},3986:e=>{"use strict";e.exports=require("body-parser")},5022:e=>{"use strict";e.exports=require("chalk")},7455:e=>{"use strict";e.exports=require("compression")},9710:e=>{"use strict";e.exports=require("cookie-parser")},7805:e=>{"use strict";e.exports=require("detect-node")},6860:e=>{"use strict";e.exports=require("express")},5115:e=>{"use strict";e.exports=require("express-promise-router")},9470:e=>{"use strict";e.exports=require("morgan")},4471:e=>{"use strict";e.exports=require("node-object-hash")},5900:e=>{"use strict";e.exports=require("pg")},9719:e=>{"use strict";e.exports=require("pg-copy-streams")},7104:e=>{"use strict";e.exports=require("qs")},6689:e=>{"use strict";e.exports=require("react")},5258:e=>{"use strict";e.exports=require("react-blurhash-async")},8684:e=>{"use strict";e.exports=require("react-dom/server")},4498:e=>{"use strict";e.exports=require("react-hot-loader")},3308:e=>{"use strict";e.exports=require("react-router")},4661:e=>{"use strict";e.exports=require("react-router-dom")},1187:e=>{"use strict";e.exports=require("react-toastify")},6827:e=>{"use strict";e.exports=require("resize-observer-polyfill")},3501:e=>{"use strict";e.exports=require("source-map-support/register")},2419:e=>{"use strict";e.exports=require("sql-template-strings")},9066:e=>{"use strict";e.exports=require("yaml")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},1017:e=>{"use strict";e.exports=require("path")},4521:e=>{"use strict";e.exports=require("readline")},4147:e=>{"use strict";e.exports=JSON.parse('{"name":"hybooru","description":"Hydrus-based booru-styled imageboard in React","version":"1.11.0","engines":{"node":">=14.0.0","npm":">=7.0.0"},"main":"server.ts","author":"Fun Maker","repository":"https://github.com/funmaker/Hybooru","scripts":{"start":"rm -rf build && webpack --config webpack/server.dev.babel.js","start:prod":"cd dist && npm start","build:prod":"mkdir -p dist && npm-run-all build:prod-*","build:prod-server":"webpack --config webpack/server.babel.js","build:prod-client":"webpack --config webpack/client.babel.js","build:prod-static":"cp -rL static dist/","build:prod-package":"babel-node webpack/package.babel.js","lint":"eslint --ext .js --ext .jsx --ext .ts --ext .tsx --max-warnings 0 --ignore-path .gitignore .","lint-fix":"eslint --ext .js --ext .jsx --ext .ts --ext .tsx --ignore-path .gitignore . --fix"},"dependencies":{"@octokit/core":"^4.1.0","@ruffle-rs/ruffle":"^0.1.0-nightly.2023.10.2","axios":"^0.21.1","better-sqlite3":"^8.0.1","body-parser":"^1.19.0","chalk":"^4.1.0","compression":"^1.7.4","cookie-parser":"^1.4.5","core-js":"^3.26.1","csv-stringify":"^5.6.2","detect-node":"^2.0.5","express":"^4.17.1","express-handlebars":"^5.3.0","express-promise-router":"^4.1.0","morgan":"^1.10.0","node-object-hash":"^2.3.1","pg":"^8.5.1","pg-copy-streams":"^5.1.1","prop-types":"^15.7.2","qs":"^6.11.2","react":"17.0.2","react-blurhash-async":"^0.0.17","react-dom":"17.0.2","react-hot-loader":"^4.13.0","react-router":"^5.2.0","react-router-dom":"^5.2.0","react-toastify":"^7.0.3","resize-observer-polyfill":"^1.5.1","source-map-support":"^0.5.19","sql-template-strings":"^2.2.2","yaml":"^1.10.2"},"devDependencies":{"@babel/core":"^7.13.14","@babel/node":"^7.13.13","@babel/plugin-proposal-class-properties":"^7.13.0","@babel/plugin-proposal-decorators":"^7.13.5","@babel/plugin-proposal-object-rest-spread":"^7.13.8","@babel/preset-env":"^7.13.12","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.14","@hot-loader/react-dom":"17.0.2","@types/better-sqlite3":"^5.4.1","@types/body-parser":"^1.19.0","@types/compression":"^1.7.0","@types/cookie-parser":"^1.4.2","@types/detect-node":"^2.0.0","@types/express":"^4.17.11","@types/morgan":"^1.9.2","@types/node":"^14.14.37","@types/pg":"^7.14.11","@types/pg-copy-streams":"^1.2.1","@types/react":"17.0.2","@types/react-dom":"17.0.2","@types/react-router":"^5.1.13","@types/react-router-dom":"^5.1.7","@types/webpack":"^5.28.0","@types/webpack-dev-middleware":"^4.1.2","@types/webpack-env":"^1.16.0","@types/webpack-hot-middleware":"^2.25.4","@typescript-eslint/eslint-plugin":"^4.20.0","@typescript-eslint/parser":"^4.20.0","babel-loader":"^8.2.2","blurhash":"^1.1.1","css-loader":"^5.2.0","css-minimizer-webpack-plugin":"^4.2.2","eslint":"^7.23.0","eslint-plugin-import":"^2.22.1","eslint-plugin-indent-empty-lines":"^1.0.1","eslint-plugin-react":"^7.33.2","eslint-plugin-react-hooks":"^4.2.0","handlebars":"^4.7.7","handlebars-loader":"^1.7.1","ignore-loader":"^0.1.2","less":"^4.1.1","less-loader":"^8.0.0","mini-css-extract-plugin":"^1.4.0","npm-run-all":"^4.1.5","raw-loader":"^4.0.2","sass":"^1.56.2","sass-loader":"^13.2.0","start-server-nestjs-webpack-plugin":"^2.2.5","start-server-webpack-plugin":"^2.2.5","style-loader":"^2.0.0","ts-loader":"^8.1.0","ts-node":"^9.1.1","typescript":"^4.2.3","webpack":"^5.65.0","webpack-cli":"^4.6.0","webpack-dev-middleware":"^4.1.0","webpack-hot-middleware":"^2.25.0","webpack-node-externals":"^2.5.2"}}')}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(8676)})();
//# sourceMappingURL=server.js.map